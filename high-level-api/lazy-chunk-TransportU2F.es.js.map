{"version":3,"file":"lazy-chunk-TransportU2F.es.js","sources":["source-mapped://source-mapped/node_modules/u2f-api/lib/google-u2f-api.js","source-mapped://source-mapped/node_modules/u2f-api/lib/u2f-api.js","source-mapped://source-mapped/node_modules/u2f-api/index.js","source-mapped://source-mapped/node_modules/@ledgerhq/hw-transport-u2f/src/TransportU2F.js"],"sourcesContent":["// Copyright 2014 Google Inc. All rights reserved\n//\n// Use of this source code is governed by a BSD-style\n// license that can be found in the LICENSE file or at\n// https://developers.google.com/open-source/licenses/bsd\n\n/**\n * @fileoverview The U2F api.\n */\n\n'use strict';\n\n/** Namespace for the U2F api.\n * @type {Object}\n */\nvar u2f = u2f || {};\n\nmodule.exports = u2f; // Adaptation for u2f-api package\n\n/**\n * The U2F extension id\n * @type {string}\n * @const\n */\nu2f.EXTENSION_ID = 'kmendfapggjehodndflmmgagdbamhnfd';\n\n/**\n * Message types for messsages to/from the extension\n * @const\n * @enum {string}\n */\nu2f.MessageTypes = {\n  'U2F_REGISTER_REQUEST': 'u2f_register_request',\n  'U2F_SIGN_REQUEST': 'u2f_sign_request',\n  'U2F_REGISTER_RESPONSE': 'u2f_register_response',\n  'U2F_SIGN_RESPONSE': 'u2f_sign_response'\n};\n\n/**\n * Response status codes\n * @const\n * @enum {number}\n */\nu2f.ErrorCodes = {\n  'OK': 0,\n  'OTHER_ERROR': 1,\n  'BAD_REQUEST': 2,\n  'CONFIGURATION_UNSUPPORTED': 3,\n  'DEVICE_INELIGIBLE': 4,\n  'TIMEOUT': 5\n};\n\n/**\n * A message type for registration requests\n * @typedef {{\n *   type: u2f.MessageTypes,\n *   signRequests: Array.<u2f.SignRequest>,\n *   registerRequests: ?Array.<u2f.RegisterRequest>,\n *   timeoutSeconds: ?number,\n *   requestId: ?number\n * }}\n */\nu2f.Request;\n\n/**\n * A message for registration responses\n * @typedef {{\n *   type: u2f.MessageTypes,\n *   responseData: (u2f.Error | u2f.RegisterResponse | u2f.SignResponse),\n *   requestId: ?number\n * }}\n */\nu2f.Response;\n\n/**\n * An error object for responses\n * @typedef {{\n *   errorCode: u2f.ErrorCodes,\n *   errorMessage: ?string\n * }}\n */\nu2f.Error;\n\n/**\n * Data object for a single sign request.\n * @typedef {{\n *   version: string,\n *   challenge: string,\n *   keyHandle: string,\n *   appId: string\n * }}\n */\nu2f.SignRequest;\n\n/**\n * Data object for a sign response.\n * @typedef {{\n *   keyHandle: string,\n *   signatureData: string,\n *   clientData: string\n * }}\n */\nu2f.SignResponse;\n\n/**\n * Data object for a registration request.\n * @typedef {{\n *   version: string,\n *   challenge: string,\n *   appId: string\n * }}\n */\nu2f.RegisterRequest;\n\n/**\n * Data object for a registration response.\n * @typedef {{\n *   registrationData: string,\n *   clientData: string\n * }}\n */\nu2f.RegisterResponse;\n\n\n// Low level MessagePort API support\n\n/**\n * Call MessagePort disconnect\n */\nu2f.disconnect = function() {\n  if (u2f.port_ && u2f.port_.port_) {\n    u2f.port_.port_.disconnect();\n    u2f.port_ = null;\n  }\n};\n\n/**\n * Sets up a MessagePort to the U2F extension using the\n * available mechanisms.\n * @param {function((MessagePort|u2f.WrappedChromeRuntimePort_))} callback\n */\nu2f.getMessagePort = function(callback) {\n  if (typeof chrome != 'undefined' && chrome.runtime) {\n    // The actual message here does not matter, but we need to get a reply\n    // for the callback to run. Thus, send an empty signature request\n    // in order to get a failure response.\n    var msg = {\n      type: u2f.MessageTypes.U2F_SIGN_REQUEST,\n      signRequests: []\n    };\n    chrome.runtime.sendMessage(u2f.EXTENSION_ID, msg, function() {\n      if (!chrome.runtime.lastError) {\n        // We are on a whitelisted origin and can talk directly\n        // with the extension.\n        u2f.getChromeRuntimePort_(callback);\n      } else {\n        // chrome.runtime was available, but we couldn't message\n        // the extension directly, use iframe\n        u2f.getIframePort_(callback);\n      }\n    });\n  } else {\n    // chrome.runtime was not available at all, which is normal\n    // when this origin doesn't have access to any extensions.\n    u2f.getIframePort_(callback);\n  }\n};\n\n/**\n * Connects directly to the extension via chrome.runtime.connect\n * @param {function(u2f.WrappedChromeRuntimePort_)} callback\n * @private\n */\nu2f.getChromeRuntimePort_ = function(callback) {\n  var port = chrome.runtime.connect(u2f.EXTENSION_ID,\n    {'includeTlsChannelId': true});\n  setTimeout(function() {\n    callback(null, new u2f.WrappedChromeRuntimePort_(port));\n  }, 0);\n};\n\n/**\n * A wrapper for chrome.runtime.Port that is compatible with MessagePort.\n * @param {Port} port\n * @constructor\n * @private\n */\nu2f.WrappedChromeRuntimePort_ = function(port) {\n  this.port_ = port;\n};\n\n/**\n * Posts a message on the underlying channel.\n * @param {Object} message\n */\nu2f.WrappedChromeRuntimePort_.prototype.postMessage = function(message) {\n  this.port_.postMessage(message);\n};\n\n/**\n * Emulates the HTML 5 addEventListener interface. Works only for the\n * onmessage event, which is hooked up to the chrome.runtime.Port.onMessage.\n * @param {string} eventName\n * @param {function({data: Object})} handler\n */\nu2f.WrappedChromeRuntimePort_.prototype.addEventListener =\n    function(eventName, handler) {\n  var name = eventName.toLowerCase();\n  if (name == 'message' || name == 'onmessage') {\n    this.port_.onMessage.addListener(function(message) {\n      // Emulate a minimal MessageEvent object\n      handler({'data': message});\n    });\n  } else {\n    console.error('WrappedChromeRuntimePort only supports onMessage');\n  }\n};\n\n/**\n * Sets up an embedded trampoline iframe, sourced from the extension.\n * @param {function(MessagePort)} callback\n * @private\n */\nu2f.getIframePort_ = function(callback) {\n  // Create the iframe\n  var iframeOrigin = 'chrome-extension://' + u2f.EXTENSION_ID;\n  var iframe = document.createElement('iframe');\n  iframe.src = iframeOrigin + '/u2f-comms.html';\n  iframe.setAttribute('style', 'display:none');\n  document.body.appendChild(iframe);\n\n  var hasCalledBack = false;\n\n  var channel = new MessageChannel();\n  var ready = function(message) {\n    if (message.data == 'ready') {\n      channel.port1.removeEventListener('message', ready);\n      if (!hasCalledBack)\n      {\n        hasCalledBack = true;\n        callback(null, channel.port1);\n      }\n    } else {\n      console.error('First event on iframe port was not \"ready\"');\n    }\n  };\n  channel.port1.addEventListener('message', ready);\n  channel.port1.start();\n\n  iframe.addEventListener('load', function() {\n    // Deliver the port to the iframe and initialize\n    iframe.contentWindow.postMessage('init', iframeOrigin, [channel.port2]);\n  });\n\n  // Give this 200ms to initialize, after that, we treat this method as failed\n  setTimeout(function() {\n    if (!hasCalledBack)\n    {\n      hasCalledBack = true;\n      callback(new Error(\"IFrame extension not supported\"));\n    }\n  }, 200);\n};\n\n\n// High-level JS API\n\n/**\n * Default extension response timeout in seconds.\n * @const\n */\nu2f.EXTENSION_TIMEOUT_SEC = 30;\n\n/**\n * A singleton instance for a MessagePort to the extension.\n * @type {MessagePort|u2f.WrappedChromeRuntimePort_}\n * @private\n */\nu2f.port_ = null;\n\n/**\n * Callbacks waiting for a port\n * @type {Array.<function((MessagePort|u2f.WrappedChromeRuntimePort_))>}\n * @private\n */\nu2f.waitingForPort_ = [];\n\n/**\n * A counter for requestIds.\n * @type {number}\n * @private\n */\nu2f.reqCounter_ = 0;\n\n/**\n * A map from requestIds to client callbacks\n * @type {Object.<number,(function((u2f.Error|u2f.RegisterResponse))\n *                       |function((u2f.Error|u2f.SignResponse)))>}\n * @private\n */\nu2f.callbackMap_ = {};\n\n/**\n * Creates or retrieves the MessagePort singleton to use.\n * @param {function((MessagePort|u2f.WrappedChromeRuntimePort_))} callback\n * @private\n */\nu2f.getPortSingleton_ = function(callback) {\n  if (u2f.port_) {\n    callback(null, u2f.port_);\n  } else {\n    if (u2f.waitingForPort_.length == 0) {\n      u2f.getMessagePort(function(err, port) {\n        if (!err) {\n          u2f.port_ = port;\n          u2f.port_.addEventListener('message',\n            /** @type {function(Event)} */ (u2f.responseHandler_));\n        }\n\n        // Careful, here be async callbacks. Maybe.\n        while (u2f.waitingForPort_.length)\n          u2f.waitingForPort_.shift()(err, port);\n      });\n    }\n    u2f.waitingForPort_.push(callback);\n  }\n};\n\n/**\n * Handles response messages from the extension.\n * @param {MessageEvent.<u2f.Response>} message\n * @private\n */\nu2f.responseHandler_ = function(message) {\n  var response = message.data;\n  var reqId = response['requestId'];\n  if (!reqId || !u2f.callbackMap_[reqId]) {\n    console.error('Unknown or missing requestId in response.');\n    return;\n  }\n  var cb = u2f.callbackMap_[reqId];\n  delete u2f.callbackMap_[reqId];\n  cb(null, response['responseData']);\n};\n\n/**\n * Calls the callback with true or false as first and only argument\n * @param {Function} callback\n */\nu2f.isSupported = function(callback) {\n  u2f.getPortSingleton_(function(err, port) {\n    callback(!err);\n  });\n}\n\n/**\n * Dispatches an array of sign requests to available U2F tokens.\n * @param {Array.<u2f.SignRequest>} signRequests\n * @param {function((u2f.Error|u2f.SignResponse))} callback\n * @param {number=} opt_timeoutSeconds\n */\nu2f.sign = function(signRequests, callback, opt_timeoutSeconds) {\n  u2f.getPortSingleton_(function(err, port) {\n    if (err)\n      return callback(err);\n\n    var reqId = ++u2f.reqCounter_;\n    u2f.callbackMap_[reqId] = callback;\n    var req = {\n      type: u2f.MessageTypes.U2F_SIGN_REQUEST,\n      signRequests: signRequests,\n      timeoutSeconds: (typeof opt_timeoutSeconds !== 'undefined' ?\n        opt_timeoutSeconds : u2f.EXTENSION_TIMEOUT_SEC),\n      requestId: reqId\n    };\n    port.postMessage(req);\n  });\n};\n\n/**\n * Dispatches register requests to available U2F tokens. An array of sign\n * requests identifies already registered tokens.\n * @param {Array.<u2f.RegisterRequest>} registerRequests\n * @param {Array.<u2f.SignRequest>} signRequests\n * @param {function((u2f.Error|u2f.RegisterResponse))} callback\n * @param {number=} opt_timeoutSeconds\n */\nu2f.register = function(registerRequests, signRequests,\n    callback, opt_timeoutSeconds) {\n  u2f.getPortSingleton_(function(err, port) {\n    if (err)\n      return callback(err);\n\n    var reqId = ++u2f.reqCounter_;\n    u2f.callbackMap_[reqId] = callback;\n    var req = {\n      type: u2f.MessageTypes.U2F_REGISTER_REQUEST,\n      signRequests: signRequests,\n      registerRequests: registerRequests,\n      timeoutSeconds: (typeof opt_timeoutSeconds !== 'undefined' ?\n        opt_timeoutSeconds : u2f.EXTENSION_TIMEOUT_SEC),\n      requestId: reqId\n    };\n    port.postMessage(req);\n  });\n};\n","'use strict';\n\nmodule.exports = API;\n\nvar chromeApi = require( './google-u2f-api' );\n\n// Feature detection (yes really)\nvar isBrowser = ( typeof navigator !== 'undefined' ) && !!navigator.userAgent;\nvar isSafari = isBrowser && navigator.userAgent.match( /Safari\\// )\n\t&& !navigator.userAgent.match( /Chrome\\// );\nvar isEDGE = isBrowser && navigator.userAgent.match( /Edge\\/1[2345]/ );\n\nvar _backend = null;\nfunction getBackend( Promise )\n{\n\tif ( !_backend )\n\t\t_backend = new Promise( function( resolve, reject )\n\t\t{\n\t\t\tfunction notSupported( )\n\t\t\t{\n\t\t\t\t// Note; {native: true} means *not* using Google's hack\n\t\t\t\tresolve( { u2f: null, native: true } );\n\t\t\t}\n\n\t\t\tif ( !isBrowser )\n\t\t\t\treturn notSupported( );\n\n\t\t\tif ( isSafari )\n\t\t\t\t// Safari doesn't support U2F, and the Safari-FIDO-U2F\n\t\t\t\t// extension lacks full support (Multi-facet apps), so we\n\t\t\t\t// block it until proper support.\n\t\t\t\treturn notSupported( );\n\n\t\t\tvar hasNativeSupport =\n\t\t\t\t( typeof window.u2f !== 'undefined' ) &&\n\t\t\t\t( typeof window.u2f.sign === 'function' );\n\n\t\t\tif ( hasNativeSupport )\n\t\t\t\tresolve( { u2f: window.u2f, native: true } );\n\n\t\t\tif ( isEDGE )\n\t\t\t\t// We don't want to check for Google's extension hack on EDGE\n\t\t\t\t// as it'll cause trouble (popups, etc)\n\t\t\t\treturn notSupported( );\n\n\t\t\tif ( location.protocol === 'http:' )\n\t\t\t\t// U2F isn't supported over http, only https\n\t\t\t\treturn notSupported( );\n\n\t\t\tif ( typeof MessageChannel === 'undefined' )\n\t\t\t\t// Unsupported browser, the chrome hack would throw\n\t\t\t\treturn notSupported( );\n\n\t\t\t// Test for google extension support\n\t\t\tchromeApi.isSupported( function( ok )\n\t\t\t{\n\t\t\t\tif ( ok )\n\t\t\t\t\tresolve( { u2f: chromeApi, native: false } );\n\t\t\t\telse\n\t\t\t\t\tnotSupported( );\n\t\t\t} );\n\t\t} );\n\n\treturn _backend;\n}\n\nfunction API( Promise )\n{\n\treturn {\n\t\tisSupported   : isSupported.bind( Promise ),\n\t\tensureSupport : ensureSupport.bind( Promise ),\n\t\tregister      : register.bind( Promise ),\n\t\tsign          : sign.bind( Promise ),\n\t\tErrorCodes    : API.ErrorCodes,\n\t\tErrorNames    : API.ErrorNames\n\t};\n}\n\nAPI.ErrorCodes = {\n\tCANCELLED: -1,\n\tOK: 0,\n\tOTHER_ERROR: 1,\n\tBAD_REQUEST: 2,\n\tCONFIGURATION_UNSUPPORTED: 3,\n\tDEVICE_INELIGIBLE: 4,\n\tTIMEOUT: 5\n};\nAPI.ErrorNames = {\n\t\"-1\": \"CANCELLED\",\n\t\"0\": \"OK\",\n\t\"1\": \"OTHER_ERROR\",\n\t\"2\": \"BAD_REQUEST\",\n\t\"3\": \"CONFIGURATION_UNSUPPORTED\",\n\t\"4\": \"DEVICE_INELIGIBLE\",\n\t\"5\": \"TIMEOUT\"\n};\n\nfunction makeError( msg, err )\n{\n\tvar code = err != null ? err.errorCode : 1; // Default to OTHER_ERROR\n\tvar type = API.ErrorNames[ '' + code ];\n\tvar error = new Error( msg );\n\terror.metaData = {\n\t\ttype: type,\n\t\tcode: code\n\t}\n\treturn error;\n}\n\nfunction deferPromise( Promise, promise )\n{\n\tvar ret = { };\n\tret.promise = new Promise( function( resolve, reject ) {\n\t\tret.resolve = resolve;\n\t\tret.reject = reject;\n\t\tpromise.then( resolve, reject );\n\t} );\n\t/**\n\t * Reject request promise and disconnect port if 'disconnect' flag is true\n\t * @param {string} msg\n\t * @param {boolean} disconnect\n\t */\n\tret.promise.cancel = function( msg, disconnect )\n\t{\n\t\tgetBackend( Promise )\n\t\t.then( function( backend )\n\t\t{\n\t\t\tif ( disconnect && !backend.native )\n\t\t\t\tbackend.u2f.disconnect( );\n\n\t\t\tret.reject( makeError( msg, { errorCode: -1 } ) );\n\t\t} );\n\t};\n\treturn ret;\n}\n\nfunction defer( Promise, fun )\n{\n\treturn deferPromise( Promise, new Promise( function( resolve, reject )\n\t{\n\t\ttry\n\t\t{\n\t\t\tfun && fun( resolve, reject );\n\t\t}\n\t\tcatch ( err )\n\t\t{\n\t\t\treject( err );\n\t\t}\n\t} ) );\n}\n\nfunction isSupported( )\n{\n\tvar Promise = this;\n\n\treturn getBackend( Promise )\n\t.then( function( backend )\n\t{\n\t\treturn !!backend.u2f;\n\t} );\n}\n\nfunction _ensureSupport( backend )\n{\n\tif ( !backend.u2f )\n\t{\n\t\tif ( location.protocol === 'http:' )\n\t\t\tthrow new Error( \"U2F isn't supported over http, only https\" );\n\t\tthrow new Error( \"U2F not supported\" );\n\t}\n}\n\nfunction ensureSupport( )\n{\n\tvar Promise = this;\n\n\treturn getBackend( Promise )\n\t.then( _ensureSupport );\n}\n\nfunction register( registerRequests, signRequests /* = null */, timeout )\n{\n\tvar Promise = this;\n\n\tif ( !Array.isArray( registerRequests ) )\n\t\tregisterRequests = [ registerRequests ];\n\n\tif ( typeof signRequests === 'number' && typeof timeout === 'undefined' )\n\t{\n\t\ttimeout = signRequests;\n\t\tsignRequests = null;\n\t}\n\n\tif ( !signRequests )\n\t\tsignRequests = [ ];\n\n\treturn deferPromise( Promise, getBackend( Promise )\n\t.then( function( backend )\n\t{\n\t\t_ensureSupport( backend );\n\n\t\tvar native = backend.native;\n\t\tvar u2f = backend.u2f;\n\n\t\treturn new Promise( function( resolve, reject )\n\t\t{\n\t\t\tfunction cbNative( response )\n\t\t\t{\n\t\t\t\tif ( response.errorCode )\n\t\t\t\t\treject( makeError( \"Registration failed\", response ) );\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tdelete response.errorCode;\n\t\t\t\t\tresolve( response );\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction cbChrome( err, response )\n\t\t\t{\n\t\t\t\tif ( err )\n\t\t\t\t\treject( err );\n\t\t\t\telse if ( response.errorCode )\n\t\t\t\t\treject( makeError( \"Registration failed\", response ) );\n\t\t\t\telse\n\t\t\t\t\tresolve( response );\n\t\t\t}\n\n\t\t\tif ( native )\n\t\t\t{\n\t\t\t\tvar appId = registerRequests[ 0 ].appId;\n\n\t\t\t\tu2f.register(\n\t\t\t\t\tappId, registerRequests, signRequests, cbNative, timeout );\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tu2f.register(\n\t\t\t\t\tregisterRequests, signRequests, cbChrome, timeout );\n\t\t\t}\n\t\t} );\n\t} ) ).promise;\n}\n\nfunction sign( signRequests, timeout )\n{\n\tvar Promise = this;\n\n\tif ( !Array.isArray( signRequests ) )\n\t\tsignRequests = [ signRequests ];\n\n\treturn deferPromise( Promise, getBackend( Promise )\n\t.then( function( backend )\n\t{\n\t\t_ensureSupport( backend );\n\n\t\tvar native = backend.native;\n\t\tvar u2f = backend.u2f;\n\n\t\treturn new Promise( function( resolve, reject )\n\t\t{\n\t\t\tfunction cbNative( response )\n\t\t\t{\n\t\t\t\tif ( response.errorCode )\n\t\t\t\t\treject( makeError( \"Sign failed\", response ) );\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tdelete response.errorCode;\n\t\t\t\t\tresolve( response );\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction cbChrome( err, response )\n\t\t\t{\n\t\t\t\tif ( err )\n\t\t\t\t\treject( err );\n\t\t\t\telse if ( response.errorCode )\n\t\t\t\t\treject( makeError( \"Sign failed\", response ) );\n\t\t\t\telse\n\t\t\t\t\tresolve( response );\n\t\t\t}\n\n\t\t\tif ( native )\n\t\t\t{\n\t\t\t\tvar appId = signRequests[ 0 ].appId;\n\t\t\t\tvar challenge = signRequests[ 0 ].challenge;\n\n\t\t\t\tu2f.sign( appId, challenge, signRequests, cbNative, timeout );\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tu2f.sign( signRequests, cbChrome, timeout );\n\t\t\t}\n\t\t} );\n\t} ) ).promise;\n}\n\nfunction makeDefault( func )\n{\n\tAPI[ func ] = function( )\n\t{\n\t\tif ( !global.Promise )\n\t\t\t// This is very unlikely to ever happen, since browsers\n\t\t\t// supporting U2F will most likely support Promises.\n\t\t\tthrow new Error( \"The platform doesn't natively support promises\" );\n\n\t\tvar args = [ ].slice.call( arguments );\n\t\treturn API( global.Promise )[ func ].apply( null, args );\n\t};\n}\n\n// Provide default functions using the built-in Promise if available.\nmakeDefault( 'isSupported' );\nmakeDefault( 'ensureSupport' );\nmakeDefault( 'register' );\nmakeDefault( 'sign' );\n","'use strict';\nmodule.exports = require( './lib/u2f-api' );","//@flow\n\nimport { sign, isSupported } from \"u2f-api\";\nimport Transport from \"@ledgerhq/hw-transport\";\nimport { log } from \"@ledgerhq/logs\";\nimport { TransportError } from \"@ledgerhq/errors\";\n\nfunction wrapU2FTransportError(originalError, message, id) {\n  const err = new TransportError(message, id);\n  // $FlowFixMe\n  err.originalError = originalError;\n  return err;\n}\n\nfunction wrapApdu(apdu: Buffer, key: Buffer) {\n  const result = Buffer.alloc(apdu.length);\n  for (let i = 0; i < apdu.length; i++) {\n    result[i] = apdu[i] ^ key[i % key.length];\n  }\n  return result;\n}\n\n// Convert from normal to web-safe, strip trailing \"=\"s\nconst webSafe64 = (base64: string) =>\n  base64\n    .replace(/\\+/g, \"-\")\n    .replace(/\\//g, \"_\")\n    .replace(/=+$/, \"\");\n\n// Convert from web-safe to normal, add trailing \"=\"s\nconst normal64 = (base64: string) =>\n  base64.replace(/-/g, \"+\").replace(/_/g, \"/\") +\n  \"==\".substring(0, (3 * base64.length) % 4);\n\nfunction attemptExchange(\n  apdu: Buffer,\n  timeoutMillis: number,\n  scrambleKey: Buffer,\n  unwrap: boolean\n): Promise<Buffer> {\n  const keyHandle = wrapApdu(apdu, scrambleKey);\n  const challenge = Buffer.from(\n    \"0000000000000000000000000000000000000000000000000000000000000000\",\n    \"hex\"\n  );\n  const signRequest = {\n    version: \"U2F_V2\",\n    keyHandle: webSafe64(keyHandle.toString(\"base64\")),\n    challenge: webSafe64(challenge.toString(\"base64\")),\n    appId: location.origin\n  };\n  log(\"apdu\", \"=> \" + apdu.toString(\"hex\"));\n  return sign(signRequest, timeoutMillis / 1000).then(response => {\n    const { signatureData } = response;\n    if (typeof signatureData === \"string\") {\n      const data = Buffer.from(normal64(signatureData), \"base64\");\n      let result;\n      if (!unwrap) {\n        result = data;\n      } else {\n        result = data.slice(5);\n      }\n      log(\"apdu\", \"<= \" + result.toString(\"hex\"));\n      return result;\n    } else {\n      throw response;\n    }\n  });\n}\n\nlet transportInstances = [];\n\nfunction emitDisconnect() {\n  transportInstances.forEach(t => t.emit(\"disconnect\"));\n  transportInstances = [];\n}\n\nfunction isTimeoutU2FError(u2fError) {\n  return u2fError.metaData.code === 5;\n}\n\n/**\n * U2F web Transport implementation\n * @example\n * import TransportU2F from \"@ledgerhq/hw-transport-u2f\";\n * ...\n * TransportU2F.create().then(transport => ...)\n */\nexport default class TransportU2F extends Transport<null> {\n  static isSupported = isSupported;\n\n  /*\n   */\n  static list = (): * =>\n    // this transport is not discoverable but we are going to guess if it is here with isSupported()\n    isSupported().then(supported => (supported ? [null] : []));\n\n  /*\n   */\n  static listen = (observer: *) => {\n    let unsubscribed = false;\n    isSupported().then(supported => {\n      if (unsubscribed) return;\n      if (supported) {\n        observer.next({ type: \"add\", descriptor: null });\n        observer.complete();\n      } else {\n        observer.error(\n          new TransportError(\n            \"U2F browser support is needed for Ledger. \" +\n              \"Please use Chrome, Opera or Firefox with a U2F extension. \" +\n              \"Also make sure you're on an HTTPS connection\",\n            \"U2FNotSupported\"\n          )\n        );\n      }\n    });\n    return {\n      unsubscribe: () => {\n        unsubscribed = true;\n      }\n    };\n  };\n\n  scrambleKey: Buffer;\n\n  unwrap: boolean = true;\n\n  /**\n   * static function to create a new Transport from a connected Ledger device discoverable via U2F (browser support)\n   */\n  static async open(_: *, _openTimeout?: number = 5000): Promise<TransportU2F> {\n    return new TransportU2F();\n  }\n\n  constructor() {\n    super();\n    transportInstances.push(this);\n  }\n\n  /**\n   * Exchange with the device using APDU protocol.\n   * @param apdu\n   * @returns a promise of apdu response\n   */\n  async exchange(apdu: Buffer): Promise<Buffer> {\n    try {\n      return await attemptExchange(\n        apdu,\n        this.exchangeTimeout,\n        this.scrambleKey,\n        this.unwrap\n      );\n    } catch (e) {\n      const isU2FError = typeof e.metaData === \"object\";\n      if (isU2FError) {\n        if (isTimeoutU2FError(e)) {\n          emitDisconnect();\n        }\n        // the wrapping make error more usable and \"printable\" to the end user.\n        throw wrapU2FTransportError(\n          e,\n          \"Failed to sign with Ledger device: U2F \" + e.metaData.type,\n          \"U2F_\" + e.metaData.code\n        );\n      } else {\n        throw e;\n      }\n    }\n  }\n\n  /**\n   */\n  setScrambleKey(scrambleKey: string) {\n    this.scrambleKey = Buffer.from(scrambleKey, \"ascii\");\n  }\n\n  /**\n   */\n  setUnwrap(unwrap: boolean) {\n    this.unwrap = unwrap;\n  }\n\n  close(): Promise<void> {\n    // u2f have no way to clean things up\n    return Promise.resolve();\n  }\n}\n"],"names":["chromeApi","global","require$$0","wrapU2FTransportError","originalError","message","id","err","TransportError","wrapApdu","apdu","key","result","Buffer","alloc","length","i","webSafe64","base64","replace","normal64","substring","attemptExchange","timeoutMillis","scrambleKey","unwrap","keyHandle","challenge","from","signRequest","version","toString","appId","location","origin","log","sign","then","response","signatureData","data","slice","transportInstances","emitDisconnect","forEach","t","emit","isTimeoutU2FError","u2fError","metaData","code","TransportU2F","Transport","open","_","_openTimeout","constructor","push","exchange","exchangeTimeout","e","isU2FError","type","setScrambleKey","setUnwrap","close","Promise","resolve","isSupported","list","supported","listen","observer","unsubscribed","next","descriptor","complete","error","unsubscribe"],"mappings":"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"}