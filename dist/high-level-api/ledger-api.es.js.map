{"version":3,"file":"ledger-api.es.js","sources":["source-mapped://source-mapped/src/lib/observable.ts","source-mapped://source-mapped/src/lib/constants.ts","source-mapped://source-mapped/src/high-level-api/transport-utils.ts","source-mapped://source-mapped/src/high-level-api/app-utils.ts","source-mapped://source-mapped/src/high-level-api/constants.ts","source-mapped://source-mapped/src/high-level-api/bip32-utils.ts","source-mapped://source-mapped/src/high-level-api/error-state.ts","source-mapped://source-mapped/src/high-level-api/ledger-api.ts"],"sourcesContent":["export type EventListener = (...args: any[]) => void;\n\nexport default class Observable {\n    private _listeners: Map<string, EventListener[]> = new Map();\n\n    public on(eventType: string, listener: EventListener): void {\n        if (!this._listeners.has(eventType)) {\n            this._listeners.set(eventType, [listener]);\n        } else {\n            this._listeners.get(eventType)!.push(listener);\n        }\n    }\n\n    public off(eventType: string, listener: EventListener): void {\n        const listenersForEvent = this._listeners.get(eventType);\n        if (!listenersForEvent) return;\n        const index = listenersForEvent.indexOf(listener);\n        if (index === -1) return;\n        listenersForEvent.splice(index, 1);\n    }\n\n    public once(eventType: string, listener: EventListener): void {\n        const onceListener: EventListener = ((...args: any[]) => {\n            this.off(eventType, onceListener);\n            listener(...args);\n        });\n        this.on(eventType, onceListener);\n    }\n\n    public fire(eventName: string, ...args: any[]): void {\n        // Let current micro task finish before invoking listeners\n        setTimeout(() => {\n            const listenersForEvent = this._listeners.get(eventName);\n            if (!listenersForEvent) return;\n            for (const listener of listenersForEvent) {\n                listener(...args);\n            }\n        }, 0);\n    }\n}\n","// Constant shared between the low-level-api and the high-level-api.\n// As a separate file to be able to use these constants in the main chunk without the need to import the entire lazy\n// chunks of the low level api, and to avoid circular dependencies between main entry and other files.\n\nexport enum NimiqVersion {\n    ALBATROSS = 'albatross',\n    LEGACY = 'legacy',\n}\n","/// <reference path=\"../lib/type-shims.d.ts\" />\n\ntype TransportConstructor = typeof import('@ledgerhq/hw-transport').default;\ntype TransportWebUsbConstructor = typeof import('@ledgerhq/hw-transport-webusb').default;\n\nexport enum TransportType {\n    WEB_HID = 'web-hid',\n    WEB_USB = 'web-usb',\n    WEB_BLE = 'web-ble',\n    WEB_AUTHN = 'web-authn',\n    U2F = 'u2f',\n    NETWORK = 'network',\n}\n\nexport function isSupported(transportType?: TransportType): boolean {\n    if (!transportType) return !!autoDetectTransportTypeToUse();\n    if (transportType !== TransportType.NETWORK && window.location.protocol !== 'https:') return false;\n    // inspired by @ledgerhq/hw-transport libs\n    switch (transportType) {\n        case TransportType.WEB_HID:\n            return 'hid' in window.navigator;\n        case TransportType.WEB_USB:\n            // @ts-ignore\n            return 'usb' in window.navigator && typeof window.navigator.usb.getDevices === 'function';\n        case TransportType.WEB_BLE:\n            return 'bluetooth' in window.navigator;\n        case TransportType.WEB_AUTHN:\n            return !!navigator.credentials;\n        case TransportType.U2F:\n            // Note that Chrome, Opera and Edge use an internal, hidden cryptotoken extension to handle u2f\n            // (https://github.com/google/u2f-ref-code/blob/master/u2f-gae-demo/war/js/u2f-api.js) which does not\n            // expose the u2f api on window. Support via that extension is not detected by this check. However, as\n            // these browsers support WebUSB, this is acceptable and we don't use a more elaborate check like the one\n            // in the 'u2f-api' package to avoid bundling it and also because it's async, complicating the code.\n            // @ts-ignore\n            return 'u2f' in window && typeof window.u2f.sign === 'function';\n        case TransportType.NETWORK:\n            return 'fetch' in window && 'WebSocket' in window;\n        default:\n            return false;\n    }\n}\n\nexport function autoDetectTransportTypeToUse(): TransportType | null {\n    // Determine the best available transport type. Exclude WebBle as it's only suitable for Nano X.\n    // See transport-comparison.md for a more complete comparison of different transport types.\n    // TODO once the Ledger Live WebSocket bridge is available to users, add TransportType.NETWORK\n    const transportTypesByPreference = [\n        // WebHID is preferable over WebUSB because Chrome 91 broke the WebUSB support. Also WebHID has better\n        // compatibility on Windows due to driver issues for WebUSB for the Nano X.\n        TransportType.WEB_HID,\n        // If WebHID is not available, WebUSB generally also works well.\n        TransportType.WEB_USB,\n        // WebAuthn and U2F as fallbacks which are generally less stable though and can time out. They also cause native\n        // Windows security prompts in Windows and additionally Firefox internal popups in Firefox on all platforms.\n        // WebAuthn preferred over U2F, as compared to U2F better browser support and less quirky / not deprecated\n        // and works better with Nano X. But causes a popup in Chrome which U2F does not.\n        TransportType.WEB_AUTHN,\n        // U2F as last resort.\n        TransportType.U2F,\n    ];\n    return transportTypesByPreference.find(isSupported) || null;\n}\n\nlet networkEndpoint: string = 'ws://127.0.0.1:8435'; // Ledger Live WebSocket bridge default endpoint\n\n/**\n * Set the network endpoint for TransportType.NETWORK. Supported are http/https and ws/wss endpoints.\n * @param endpoint\n */\nexport function setNetworkEndpoint(endpoint: string): void {\n    networkEndpoint = endpoint;\n}\n\nexport function getNetworkEndpoint(): string {\n    return networkEndpoint;\n}\n\n/**\n * Lazy load the library for a transport type.\n * @param transportType\n */\nexport async function loadTransportLibrary(transportType: TransportType)\n    : Promise<TransportWebUsbConstructor | TransportConstructor> {\n    switch (transportType) {\n        case TransportType.WEB_HID:\n            return (await import('@ledgerhq/hw-transport-webhid')).default;\n        case TransportType.WEB_USB:\n            return (await import('@ledgerhq/hw-transport-webusb')).default;\n        case TransportType.WEB_BLE:\n            return (await import('@ledgerhq/hw-transport-web-ble')).default;\n        case TransportType.WEB_AUTHN:\n            return (await import('@ledgerhq/hw-transport-webauthn')).default;\n        case TransportType.U2F:\n            return (await import('@ledgerhq/hw-transport-u2f')).default;\n        case TransportType.NETWORK:\n            return (await import('@ledgerhq/hw-transport-http')).default([networkEndpoint]);\n        default:\n            throw new Error(`Unknown transport type ${transportType}`);\n    }\n}\n","export function isAppSupported(\n    app: string,\n    requiredApp: string,\n    allowLegacyApp: boolean,\n    allowSpeculos: boolean,\n): boolean {\n    return app === requiredApp\n        || (allowLegacyApp && app === getLegacyApp(requiredApp))\n        || (allowSpeculos && app === 'app'); // speculos reports 'app' as appName\n}\n\nexport function isAppVersionSupported(versionString: string, minRequiredVersion: string): boolean {\n    const version = versionString.split('.').map((part) => parseInt(part, 10));\n    const parsedMinRequiredVersion = minRequiredVersion.split('.').map((part) => parseInt(part, 10));\n    for (let i = 0; i < minRequiredVersion.length; ++i) {\n        if (typeof version[i] === 'undefined' || version[i] < parsedMinRequiredVersion[i]) return false;\n        if (version[i] > parsedMinRequiredVersion[i]) return true;\n    }\n    return true;\n}\n\nexport function isLegacyApp(app: string) {\n    return app.endsWith(' Legacy');\n}\n\nexport function getLegacyApp(app: string) {\n    // Add ' Legacy' suffix to the app name, or preserve it if it already exists.\n    return app.replace(/(?: Legacy)?$/, ' Legacy');\n}\n","// Constants for the high-level-api needed in lazy chunks and the main chunk.\n// As a separate file to be able to use these constants in the main chunk without the need to import the entire lazy\n// chunks and to avoid circular dependencies between main entry and other files.\n\nimport { NimiqVersion } from '../lib/constants';\n\nexport enum Coin {\n    NIMIQ = 'Nimiq',\n    BITCOIN = 'Bitcoin',\n}\n\nexport enum Network {\n    MAINNET = 'main',\n    TESTNET = 'test',\n    DEVNET = 'dev',\n}\n\n// See https://github.com/nimiq/core-rs-albatross/blob/albatross/primitives/src/networks.rs\nexport const NetworkIdNimiq = {\n    [Network.MAINNET]: 24,\n    [Network.TESTNET]: 5,\n    [Network.DEVNET]: 6,\n    [NimiqVersion.LEGACY]: {\n        [Network.MAINNET]: 42,\n        [Network.TESTNET]: 1,\n        [Network.DEVNET]: 2,\n    },\n} as const;\n\n// See https://github.com/nimiq/core-rs-albatross/blob/albatross/primitives/src/account.rs\n// We redefine this enum, to avoid Nimiq core being bundled, or parts of it.\nexport enum AccountTypeNimiq {\n    BASIC = 0,\n    VESTING = 1,\n    HTLC = 2,\n    STAKING = 3,\n}\n\n// See https://github.com/nimiq/core-rs-albatross/blob/albatross/primitives/transaction/src/lib.rs\nexport enum TransactionFlagsNimiq {\n    NONE = 0b0,\n    CONTRACT_CREATION = 0b1,\n    SIGNALING = 0b10,\n}\n\nexport enum AddressTypeBitcoin {\n    LEGACY = 'legacy-bitcoin',\n    P2SH_SEGWIT = 'p2sh-segwit-bitcoin',\n    NATIVE_SEGWIT = 'native-segwit-bitcoin',\n}\n\nexport const LedgerAddressFormatMapBitcoin = {\n    [AddressTypeBitcoin.LEGACY]: 'legacy' as 'legacy',\n    [AddressTypeBitcoin.P2SH_SEGWIT]: 'p2sh' as 'p2sh',\n    [AddressTypeBitcoin.NATIVE_SEGWIT]: 'bech32' as 'bech32',\n};\n\nexport const REQUEST_EVENT_CANCEL = 'cancel';\n\nexport enum RequestTypeNimiq {\n    GET_WALLET_ID = 'get-wallet-id-nimiq',\n    DERIVE_ADDRESSES = 'derive-addresses-nimiq',\n    GET_PUBLIC_KEY = 'get-public-key-nimiq',\n    GET_ADDRESS = 'get-address-nimiq',\n    SIGN_TRANSACTION = 'sign-transaction-nimiq',\n    SIGN_MESSAGE = 'sign-message-nimiq',\n}\n\nexport enum RequestTypeBitcoin {\n    GET_WALLET_ID = 'get-wallet-id-bitcoin',\n    GET_ADDRESS_AND_PUBLIC_KEY = 'get-address-and-public-key-bitcoin',\n    GET_EXTENDED_PUBLIC_KEY = 'get-extended-public-key-bitcoin',\n    SIGN_TRANSACTION = 'sign-transaction-bitcoin',\n    SIGN_MESSAGE = 'sign-message-bitcoin',\n}\n","import { AddressTypeBitcoin, Coin, Network } from './constants';\n\ntype Bip32PathParams = {\n    addressIndex: number,\n    accountIndex?: number,\n} & ({\n    coin: Coin.NIMIQ,\n} | {\n    coin: Coin.BITCOIN,\n    addressType?: AddressTypeBitcoin,\n    network?: Exclude<Network, Network.DEVNET>,\n    isInternal?: boolean,\n});\n\n// See BIP44\nconst PATH_REGEX = new RegExp(\n    '^'\n    + '(?:m/)?' // optional m/ prefix\n    + '(\\\\d+)\\'/' // purpose id; BIP44 (BTC legacy or Nimiq) / BIP49 (BTC nested SegWit) / BIP84 (BTC native SegWit)\n    + '(\\\\d+)\\'/' // coin type; 0 for Bitcoin Mainnet, 1 for Bitcoin Testnet, 242 for Nimiq\n    + '(\\\\d+)\\'/' // account index\n    + '(?:(\\\\d+)/)?' // 0 for external or 1 for internal address (change); non-hardened; unset for Nimiq\n    + '(\\\\d+)(\\'?)' // address index; non-hardened for BTC, hardened for Nimiq\n    + '$',\n);\n\nconst PURPOSE_ID_MAP_BITCOIN = new Map<AddressTypeBitcoin, number>([\n    [AddressTypeBitcoin.LEGACY, 44],\n    [AddressTypeBitcoin.P2SH_SEGWIT, 49],\n    [AddressTypeBitcoin.NATIVE_SEGWIT, 84],\n]);\n\n/**\n * Generate a bip32 path according to path layout specified in bip44 for the specified parameters.\n */\nexport function getBip32Path(params: Bip32PathParams): string {\n    // set defaults\n    params = {\n        accountIndex: 0,\n        ...params,\n    };\n    switch (params.coin) {\n        case Coin.NIMIQ:\n            return `44'/242'/${params.accountIndex}'/${params.addressIndex}'`; // Nimiq paths are fully hardened\n        case Coin.BITCOIN: {\n            // set bitcoin specific defaults\n            params = {\n                addressType: AddressTypeBitcoin.NATIVE_SEGWIT,\n                network: Network.MAINNET,\n                isInternal: false,\n                ...params,\n            };\n            const purposeId = PURPOSE_ID_MAP_BITCOIN.get(params.addressType!);\n            const coinType = params.network === Network.TESTNET ? 1 : 0;\n            const changeType = params.isInternal ? 1 : 0;\n            return `${purposeId}'/${coinType}'/${params.accountIndex}'/${changeType}/${params.addressIndex}`;\n        }\n        default:\n            throw new Error(`Unsupported coin: ${(params as any).coin}`);\n    }\n}\n\n/**\n * Parse bip32 path according to path layout specified in bip44.\n */\nexport function parseBip32Path(path: string): Required<Bip32PathParams> & { accountPath: string } {\n    const pathMatch = path.match(PATH_REGEX);\n    if (!pathMatch) throw new Error(`${path} is not a supported bip32 path.`);\n    const purposeId = parseInt(pathMatch[1], 10);\n    const coinType = parseInt(pathMatch[2], 10);\n    const accountIndex = parseInt(pathMatch[3], 10);\n    const changeType = pathMatch[4];\n    const addressIndex = parseInt(pathMatch[5], 10);\n    const isAddressIndexHardened = !!pathMatch[6];\n\n    // Check indices for validity according to bip32. No need to check for negative or fractional numbers, as these are\n    // not accepted by the regex.\n    if (accountIndex >= 2 ** 31 || addressIndex >= 2 ** 31) throw new Error('Invalid index');\n\n    const accountPath = `${purposeId}'/${coinType}'/${accountIndex}'`;\n    switch (coinType) {\n        case 242:\n            // Nimiq\n            if (purposeId !== 44) throw new Error('Purpose id must be 44 for Nimiq');\n            if (changeType !== undefined) throw new Error('Specifying a change type is not supported for Nimiq');\n            if (!isAddressIndexHardened) throw new Error('Address index must be hardened for Nimiq');\n            return {\n                coin: Coin.NIMIQ,\n                accountIndex,\n                addressIndex,\n                accountPath,\n            };\n        case 0:\n        case 1: {\n            // Bitcoin\n            const knownPurposeIds = [...PURPOSE_ID_MAP_BITCOIN.values()];\n            if (!knownPurposeIds.includes(purposeId)) throw new Error('Purpose id must be 44, 49 or 84 for Bitcoin');\n            if (changeType === undefined) throw new Error('Specifying a change type is required for Bitcoin');\n            if (changeType !== '0' && changeType !== '1') throw new Error('Invalid change type for Bitcoin');\n            if (isAddressIndexHardened) throw new Error('Address index must not be hardened for Bitcoin');\n            const addressType = [...PURPOSE_ID_MAP_BITCOIN.entries()].find(([,pId]) => pId === purposeId)![0];\n            const network = coinType === 0 ? Network.MAINNET : Network.TESTNET;\n            const isInternal = changeType === '1';\n            return {\n                coin: Coin.BITCOIN,\n                accountIndex,\n                addressIndex,\n                addressType,\n                network,\n                isInternal,\n                accountPath,\n            };\n        }\n        default:\n            throw new Error(`Unsupported coin type ${coinType}`);\n    }\n}\n","type StateTypeError = import('./ledger-api').StateType.ERROR;\n\ntype RequestBase = import('./requests/request').default<any>;\ntype SpecificRequest = import('./ledger-api').Request;\n\nexport enum ErrorType {\n    LEDGER_BUSY = 'ledger-busy',\n    LOADING_DEPENDENCIES_FAILED = 'loading-dependencies-failed',\n    USER_INTERACTION_REQUIRED = 'user-interaction-required',\n    CONNECTION_ABORTED = 'connection-aborted',\n    BROWSER_UNSUPPORTED = 'browser-unsupported',\n    APP_OUTDATED = 'app-outdated',\n    WRONG_WALLET = 'wrong-wallet',\n    WRONG_APP = 'wrong-app',\n    REQUEST_ASSERTION_FAILED = 'request-specific-error',\n}\n\nexport default class ErrorState<T extends ErrorType = ErrorType> extends Error {\n    public readonly type: StateTypeError = 'error' as StateTypeError; // state type\n    public readonly errorType: T;\n    // request specified as SpecificRequest instead of RequestBase such that an app using the api knows what request\n    // types to expect here.\n    public request: T extends ErrorType.LOADING_DEPENDENCIES_FAILED ? SpecificRequest | undefined : SpecificRequest;\n\n    constructor(\n        errorType: T,\n        messageOrError: string | Error,\n        // request specified as RequestBase here to allow simple throwing from a SpecificRequest parent class.\n        request: T extends ErrorType.LOADING_DEPENDENCIES_FAILED ? RequestBase | undefined : RequestBase,\n    ) {\n        super(messageOrError.toString());\n\n        if (messageOrError instanceof Error && messageOrError.stack) {\n            this.stack = messageOrError.stack;\n        } else if (Error.captureStackTrace) {\n            // Maintains proper stack trace for where our error was thrown (only available on V8), see\n            // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Error#Custom_Error_Types\n            Error.captureStackTrace(this, ErrorState);\n        }\n\n        this.name = 'LedgerErrorState';\n        this.errorType = errorType;\n        this.request = request as any;\n    }\n}\n","import Observable, { EventListener } from '../lib/observable';\nimport { NimiqVersion } from '../lib/constants';\nimport type { NimiqPrimitive } from '../lib/load-nimiq';\nimport {\n    autoDetectTransportTypeToUse,\n    isSupported,\n    getNetworkEndpoint,\n    setNetworkEndpoint,\n    loadTransportLibrary,\n    TransportType,\n} from './transport-utils';\nimport { isAppSupported } from './app-utils';\nimport { getBip32Path, parseBip32Path } from './bip32-utils';\nimport ErrorState, { ErrorType } from './error-state';\nimport {\n    AccountTypeNimiq,\n    AddressTypeBitcoin,\n    Coin,\n    Network,\n    NetworkIdNimiq,\n    REQUEST_EVENT_CANCEL,\n    RequestTypeBitcoin,\n    RequestTypeNimiq,\n    TransactionFlagsNimiq,\n} from './constants';\n\ntype TransportConstructor = typeof import('@ledgerhq/hw-transport').default;\ntype TransportWebUsbConstructor = typeof import('@ledgerhq/hw-transport-webusb').default;\ntype Transport = InstanceType<TransportConstructor | TransportWebUsbConstructor>;\n\ntype CoinAppConnection = import('./requests/request').CoinAppConnection;\n\ntype RequestType = RequestTypeNimiq | RequestTypeBitcoin;\n\ntype RequestGetWalletIdNimiqConstructor = typeof import('./requests/nimiq/request-get-wallet-id-nimiq').default;\ntype RequestGetPublicKeyNimiqConstructor = typeof import('./requests/nimiq/request-get-public-key-nimiq').default;\ntype RequestGetAddressNimiqConstructor = typeof import('./requests/nimiq/request-get-address-nimiq').default;\ntype RequestDeriveAddressesNimiqConstructor = typeof import('./requests/nimiq/request-derive-addresses-nimiq').default;\ntype RequestSignTransactionNimiqConstructor = typeof import('./requests/nimiq/request-sign-transaction-nimiq').default;\ntype RequestSignMessageNimiqConstructor = typeof import('./requests/nimiq/request-sign-message-nimiq').default;\n\ntype RequestGetWalletIdBitcoinConstructor = typeof import('./requests/bitcoin/request-get-wallet-id-bitcoin').default;\ntype RequestGetAddressAndPublicKeyBitcoinConstructor =\n    typeof import('./requests/bitcoin/request-get-address-and-public-key-bitcoin').default;\ntype RequestGetExtendedPublicKeyBitcoinConstructor =\n    typeof import('./requests/bitcoin/request-get-extended-public-key-bitcoin').default;\ntype RequestSignTransactionBitcoinConstructor =\n    typeof import('./requests/bitcoin/request-sign-transaction-bitcoin').default;\ntype RequestSignMessageBitcoinConstructor = typeof import('./requests/bitcoin/request-sign-message-bitcoin').default;\n\n// define Request type as actually defined request classes to be more specific than the abstract parent class\n/* eslint-disable @typescript-eslint/indent */\ntype RequestConstructor = RequestGetWalletIdNimiqConstructor | RequestGetPublicKeyNimiqConstructor\n    | RequestGetAddressNimiqConstructor | RequestDeriveAddressesNimiqConstructor\n    | RequestSignTransactionNimiqConstructor | RequestSignMessageNimiqConstructor\n    | RequestGetWalletIdBitcoinConstructor | RequestGetAddressAndPublicKeyBitcoinConstructor\n    | RequestGetExtendedPublicKeyBitcoinConstructor | RequestSignTransactionBitcoinConstructor\n    | RequestSignMessageBitcoinConstructor;\n/* eslint-enable @typescript-eslint/indent */\ntype Request = InstanceType<RequestConstructor>;\n\ntype TransactionInfoNimiq<Version extends NimiqVersion> =\n    import('./requests/nimiq/request-sign-transaction-nimiq').TransactionInfoNimiq<Version>;\ntype MessageSignatureInfoNimiq<Version extends NimiqVersion> =\n    import('./requests/nimiq/request-sign-message-nimiq').MessageSignatureInfoNimiq<Version>;\n\ntype TransactionInfoBitcoin = import('./requests/bitcoin/request-sign-transaction-bitcoin').TransactionInfoBitcoin;\n\nexport { isSupported, TransportType };\nexport { getBip32Path, parseBip32Path };\nexport { ErrorType, ErrorState };\nexport { Coin, Network, NimiqVersion, NetworkIdNimiq, AccountTypeNimiq, TransactionFlagsNimiq, AddressTypeBitcoin };\nexport { CoinAppConnection, RequestTypeNimiq, RequestTypeBitcoin, RequestType, Request };\nexport { TransactionInfoNimiq, TransactionInfoBitcoin };\nexport { MessageSignatureInfoNimiq };\n\nexport enum StateType {\n    IDLE = 'idle',\n    LOADING = 'loading',\n    CONNECTING = 'connecting',\n    REQUEST_PROCESSING = 'request-processing',\n    REQUEST_CANCELLING = 'request-cancelling',\n    ERROR = 'error',\n}\n\n// events appear at a single point of time while states reflect the current state of the api for a timespan ranging\n// into the future. E.g. if a request was cancelled, a REQUEST_CANCELLED event gets thrown and the state changes to\n// IDLE. Errors trigger an error state (e.g. when app outdated) and thus are a state, not an event.\nexport enum EventType {\n    STATE_CHANGE = 'state-change',\n    REQUEST_SUCCESSFUL = 'request-successful',\n    REQUEST_CANCELLED = 'request-cancelled',\n    CONNECTED = 'connected',\n}\n\nexport type State = {\n    type: StateType.IDLE | StateType.LOADING | StateType.CONNECTING,\n    request?: Request,\n} | {\n    type: StateType.REQUEST_PROCESSING | StateType.REQUEST_CANCELLING,\n    request: Request,\n} | ErrorState;\n\nexport default class LedgerApi {\n    // public fields and methods\n    public static readonly WAIT_TIME_AFTER_TIMEOUT = 1500;\n    public static readonly WAIT_TIME_AFTER_ERROR = 500;\n\n    public static readonly Nimiq = {\n        /**\n         * Get the 32 byte wallet id of the currently connected Nimiq wallet as base64.\n         */\n        async getWalletId(nimiqVersion: NimiqVersion = NimiqVersion.ALBATROSS): Promise<string> {\n            return LedgerApi._callLedger(await LedgerApi._createRequest<RequestGetWalletIdNimiqConstructor>(\n                import('./requests/nimiq/request-get-wallet-id-nimiq'),\n                nimiqVersion,\n            ));\n        },\n\n        /**\n         * Get the public key for a given bip32 key path. Optionally expect a specific wallet id.\n         */\n        async getPublicKey<Version extends NimiqVersion = NimiqVersion.ALBATROSS>(\n            keyPath: string,\n            expectedWalletId?: string,\n            nimiqVersion: Version = NimiqVersion.ALBATROSS as Version,\n        ): Promise<NimiqPrimitive<'PublicKey', Version>> {\n            return LedgerApi._callLedger(await LedgerApi._createRequest<RequestGetPublicKeyNimiqConstructor>(\n                import('./requests/nimiq/request-get-public-key-nimiq'),\n                nimiqVersion, keyPath, expectedWalletId,\n            )) as Promise<NimiqPrimitive<'PublicKey', Version>>;\n        },\n\n        /**\n         * Get the address for a given bip32 key path. Optionally display the address on the Ledger screen for\n         * verification, expect a specific address or expect a specific wallet id.\n         */\n        async getAddress(\n            keyPath: string,\n            display = false,\n            expectedAddress?: string,\n            expectedWalletId?: string,\n            nimiqVersion: NimiqVersion = NimiqVersion.ALBATROSS,\n        ): Promise<string> {\n            return LedgerApi._callLedger(await LedgerApi._createRequest<RequestGetAddressNimiqConstructor>(\n                import('./requests/nimiq/request-get-address-nimiq'),\n                nimiqVersion, keyPath, display, expectedAddress, expectedWalletId,\n            ));\n        },\n\n        /**\n         * Utility function that directly gets a confirmed address.\n         */\n        async getConfirmedAddress(\n            keyPath: string,\n            expectedWalletId?: string,\n            nimiqVersion: NimiqVersion = NimiqVersion.ALBATROSS,\n        ): Promise<string> {\n            const address = await LedgerApi.Nimiq.getAddress(keyPath, false, undefined, expectedWalletId, nimiqVersion);\n            return LedgerApi.Nimiq.getAddress(keyPath, true, address, expectedWalletId, nimiqVersion);\n        },\n\n        /**\n         * Derive addresses for given bip32 key paths. Optionally expect a specific wallet id.\n         */\n        async deriveAddresses(\n            pathsToDerive: Iterable<string>,\n            expectedWalletId?: string,\n            nimiqVersion: NimiqVersion = NimiqVersion.ALBATROSS,\n        ): Promise<Array<{ address: string, keyPath: string }>> {\n            return LedgerApi._callLedger(await LedgerApi._createRequest<RequestDeriveAddressesNimiqConstructor>(\n                import('./requests/nimiq/request-derive-addresses-nimiq'),\n                nimiqVersion, pathsToDerive, expectedWalletId,\n            ));\n        },\n\n        /**\n         * Sign a transaction for a signing key specified by its bip32 key path. Note that the signing key /\n         * corresponding address does not necessarily need to be the transaction's sender address for example for\n         * transactions sent from vesting contracts. Optionally expect a specific wallet id.\n         */\n        async signTransaction<Version extends NimiqVersion = NimiqVersion.ALBATROSS>(\n            transaction: TransactionInfoNimiq<Version>,\n            keyPath: string,\n            expectedWalletId?: string,\n            nimiqVersion: Version = NimiqVersion.ALBATROSS as Version,\n        ): Promise<NimiqPrimitive<'Transaction', Version>> {\n            return LedgerApi._callLedger(await LedgerApi._createRequest<RequestSignTransactionNimiqConstructor>(\n                import('./requests/nimiq/request-sign-transaction-nimiq'),\n                nimiqVersion, keyPath, transaction, expectedWalletId,\n            )) as Promise<NimiqPrimitive<'Transaction', Version>>;\n        },\n\n        /**\n         * Sign a message for a signing key specified by its bip32 key path. The message can be either an\n         * utf8 string or an Uint8Array of arbitrary data. Optionally request the message to preferably be displayed as\n         * hex or hash instead of as ascii, or expect a specific wallet id. If no preference for the display type is\n         * specified, the message is by default tried to be displayed as ascii, hex or hash, in that order.\n         */\n        async signMessage<Version extends NimiqVersion = NimiqVersion.ALBATROSS>(\n            message: string | Uint8Array,\n            keyPath: string,\n            flags?: { preferDisplayTypeHex: boolean, preferDisplayTypeHash: boolean } | number,\n            expectedWalletId?: string,\n            nimiqVersion: Version = NimiqVersion.ALBATROSS as Version,\n        ): Promise<MessageSignatureInfoNimiq<Version>> {\n            return await LedgerApi._callLedger(await LedgerApi._createRequest<RequestSignMessageNimiqConstructor>(\n                import('./requests/nimiq/request-sign-message-nimiq'),\n                nimiqVersion, keyPath, message, flags, expectedWalletId,\n            )) as MessageSignatureInfoNimiq<Version>;\n        },\n    };\n\n    public static readonly Bitcoin = {\n        /**\n         * Get the 32 byte wallet id of the currently connected Bitcoin wallet / app for a specific network as base64.\n         */\n        async getWalletId(network: Exclude<Network, Network.DEVNET>): Promise<string> {\n            return LedgerApi._callLedger(await LedgerApi._createRequest<RequestGetWalletIdBitcoinConstructor>(\n                import('./requests/bitcoin/request-get-wallet-id-bitcoin'),\n                network,\n            ));\n        },\n\n        /**\n         * Get the public key, address and bip32 chain code for a given bip32 key path. Optionally display the address\n         * on the Ledger screen for verification, expect a specific address or expect a specific wallet id.\n         */\n        async getAddressAndPublicKey(\n            keyPath: string,\n            display = false,\n            expectedAddress?: string,\n            expectedWalletId?: string,\n        ): Promise<{ publicKey: string, address: string, chainCode: string }> {\n            return LedgerApi._callLedger(\n                await LedgerApi._createRequest<RequestGetAddressAndPublicKeyBitcoinConstructor>(\n                    import('./requests/bitcoin/request-get-address-and-public-key-bitcoin'),\n                    keyPath, display, expectedAddress, expectedWalletId,\n                ),\n            );\n        },\n\n        /**\n         * Utility function that directly gets a confirmed address.\n         */\n        async getConfirmedAddressAndPublicKey(keyPath: string, expectedWalletId?: string)\n            : Promise<{ publicKey: string, address: string, chainCode: string }> {\n            const { address } = await LedgerApi.Bitcoin.getAddressAndPublicKey(\n                keyPath,\n                false,\n                undefined,\n                expectedWalletId,\n            );\n            return LedgerApi.Bitcoin.getAddressAndPublicKey(keyPath, true, address, expectedWalletId);\n        },\n\n        /**\n         * Get the extended public key for a bip32 path from which addresses can be derived, encoded as specified in\n         * bip32. The key path must follow the bip44 specification and at least be defined to the account level.\n         * Optionally expect a specific wallet id.\n         */\n        async getExtendedPublicKey(keyPath: string, expectedWalletId?: string): Promise<string> {\n            return LedgerApi._callLedger(await LedgerApi._createRequest<RequestGetExtendedPublicKeyBitcoinConstructor>(\n                import('./requests/bitcoin/request-get-extended-public-key-bitcoin'),\n                keyPath, expectedWalletId,\n            ));\n        },\n\n        /**\n         * Sign a transaction. See type declaration of TransactionInfoBitcoin in request-sign-transaction-bitcoin.ts\n         * for documentation of the transaction format. Optionally expect a specific wallet id. The signed transaction\n         * is returned in hex-encoded serialized form ready to be broadcast to the network.\n         */\n        async signTransaction(transaction: TransactionInfoBitcoin, expectedWalletId?: string): Promise<string> {\n            return LedgerApi._callLedger(await LedgerApi._createRequest<RequestSignTransactionBitcoinConstructor>(\n                import('./requests/bitcoin/request-sign-transaction-bitcoin'),\n                transaction, expectedWalletId,\n            ));\n        },\n\n        /**\n         * Sign a message according to bip137 with the key specified via its bip32 path. The message can be either an\n         * utf8 string or an Uint8Array of arbitrary data. Optionally expect a specific wallet id. The resulting\n         * signature is base64 encoded.\n         */\n        async signMessage(message: string | Uint8Array, keyPath: string, expectedWalletId?: string)\n            : Promise<{ signerAddress: string, signature: string }> {\n            return LedgerApi._callLedger(await LedgerApi._createRequest<RequestSignMessageBitcoinConstructor>(\n                import('./requests/bitcoin/request-sign-message-bitcoin'),\n                keyPath, message, expectedWalletId,\n            ));\n        },\n    };\n\n    public static get currentState(): State {\n        return LedgerApi._currentState;\n    }\n\n    public static get currentRequest(): Request | null {\n        return LedgerApi._currentRequest;\n    }\n\n    public static get isBusy(): boolean {\n        return !!LedgerApi._currentRequest;\n    }\n\n    public static get transportType(): TransportType | null {\n        return LedgerApi._transportType;\n    }\n\n    /**\n     * Check for general support or support of a specific transport type. Note that isSupported is additionally exported\n     * as separate export that doesn't require bundling the whole api.\n     * @param [transportType] - Transport type for which to test for support. If omitted test for support of any type.\n     */\n    public static isSupported(transportType?: TransportType): boolean {\n        return isSupported(transportType);\n    }\n\n    /**\n     * Set a specific transport type. Note that an already connected ongoing request will still use the previous\n     * transport type.\n     * @param transportType - Transport type to use for connections to Ledger devices.\n     * @param [networkEndpoint] - Custom network endpoint to use for TransportType.NETWORK. Optional.\n     */\n    public static setTransportType(transportType: TransportType): void;\n    public static setTransportType(transportType: TransportType.NETWORK, networkEndpoint?: string): void;\n    public static setTransportType(transportType: TransportType, networkEndpoint?: string) {\n        if (!isSupported(transportType)) throw new Error('Unsupported transport type.');\n        if (transportType === LedgerApi._transportType\n            && (!networkEndpoint || networkEndpoint === getNetworkEndpoint())) return;\n        LedgerApi._transportType = transportType;\n        if (transportType === TransportType.NETWORK && networkEndpoint) {\n            setNetworkEndpoint(networkEndpoint);\n        }\n        // Close api for current transport to create a new one for specified transport type on next request.\n        LedgerApi.disconnect(/* cancelRequest */ false);\n    }\n\n    public static resetTransportType() {\n        const transportType = autoDetectTransportTypeToUse();\n        if (!transportType) return;\n        LedgerApi.setTransportType(transportType);\n    }\n\n    /**\n     * Manually connect to a Ledger. Typically, this is not required as all requests establish a connection themselves.\n     * However, if that connection fails due to a required user interaction / user gesture, you can manually connect in\n     * the context of a user interaction, for example a click.\n     * @param coin - Which Ledger coin app to connect to.\n     * @param [nimiqVersion] - Only for Nimiq: which Nimiq library version to use internally. Albatross by default.\n     * @param [network] - Only for Bitcoin: whether to connect to the mainnet or testnet app. Mainnet by default.\n     * @returns Whether connecting to the Ledger succeeded.\n     */\n    public static async connect(coin: Coin): Promise<boolean>;\n    public static async connect(coin: Coin.NIMIQ, nimiqVersion: NimiqVersion): Promise<boolean>;\n    public static async connect(coin: Coin.BITCOIN, network: Exclude<Network, Network.DEVNET>): Promise<boolean>;\n    public static async connect(\n        coin: Coin,\n        nimiqVersionOrBitcoinNetwork?: NimiqVersion | Exclude<Network, Network.DEVNET>,\n    ): Promise<boolean> {\n        const nimiqVersion = nimiqVersionOrBitcoinNetwork === NimiqVersion.LEGACY\n            ? NimiqVersion.LEGACY\n            : NimiqVersion.ALBATROSS;\n        const bitcoinNetwork = nimiqVersionOrBitcoinNetwork === Network.TESTNET\n            ? Network.TESTNET\n            : Network.MAINNET;\n        LedgerApi._connectionAborted = false; // reset aborted flag on manual connection\n        try {\n            const { currentRequest, _currentConnection: currentConnection } = LedgerApi;\n            const expectedApp = coin === Coin.NIMIQ\n                ? 'Nimiq'\n                : `Bitcoin${bitcoinNetwork === Network.TESTNET ? ' Test' : ''}`;\n            if (currentConnection && currentConnection.coin === coin && isAppSupported(\n                currentConnection.app,\n                expectedApp,\n                /* allowLegacy */ coin === Coin.BITCOIN,\n                /* allowSpeculos */ true,\n            )) {\n                // Already connected.\n                return true;\n            }\n            if (currentRequest && currentRequest.coin === coin\n                && (!('network' in currentRequest) || currentRequest.network === bitcoinNetwork)) {\n                // Wait for the ongoing request for coin to connect.\n                // Initialize the transport again if it failed previously, for example due to missing user interaction.\n                await LedgerApi._getTransport(currentRequest);\n                await new Promise<void>((resolve, reject) => {\n                    const onConnect = () => {\n                        LedgerApi.off(EventType.CONNECTED, onConnect);\n                        LedgerApi.off(EventType.REQUEST_CANCELLED, onCancel);\n                        resolve();\n                    };\n                    const onCancel = () => {\n                        LedgerApi.off(EventType.CONNECTED, onConnect);\n                        LedgerApi.off(EventType.REQUEST_CANCELLED, onCancel);\n                        reject(new Error('Request cancelled')); // request cancelled via api before ledger connected\n                    };\n                    LedgerApi.on(EventType.CONNECTED, onConnect);\n                    LedgerApi.on(EventType.REQUEST_CANCELLED, onCancel);\n                });\n                return true;\n            }\n            // Send a request to establish a connection and detect when the ledger is connected.\n            // Note that if the api is already busy with a request for another coin false will be returned.\n            switch (coin) {\n                case Coin.NIMIQ:\n                    await LedgerApi.Nimiq.getWalletId(nimiqVersion);\n                    return true;\n                case Coin.BITCOIN:\n                    await LedgerApi.Bitcoin.getWalletId(bitcoinNetwork);\n                    return true;\n                default:\n                    throw new Error(`Unsupported coin: ${coin}`);\n            }\n        } catch (e) {\n            if (e instanceof ErrorState) {\n                LedgerApi._setState(e);\n            }\n            return false;\n        }\n    }\n\n    /**\n     * Disconnect the api and clean up.\n     * @param cancelRequest - Whether to cancel an ongoing request.\n     * @param requestTypesToDisconnect - If specified, only disconnect if no request is going on or if the ongoing\n     *  request is of the specified type.\n     */\n    public static async disconnect(cancelRequest = true, requestTypesToDisconnect?: RequestType | RequestType[]) {\n        const { currentRequest } = LedgerApi;\n        if (currentRequest) {\n            if (requestTypesToDisconnect !== undefined) {\n                requestTypesToDisconnect = Array.isArray(requestTypesToDisconnect)\n                    ? requestTypesToDisconnect\n                    : [requestTypesToDisconnect];\n                if (!requestTypesToDisconnect.includes(currentRequest.type)) return;\n            }\n            if (cancelRequest) {\n                currentRequest.cancel();\n            }\n        }\n\n        const transportPromise = LedgerApi._transportPromise;\n        LedgerApi._transportPromise = null;\n        LedgerApi._currentConnection = null;\n\n        if (!transportPromise) return;\n        try {\n            const api = await transportPromise;\n            await api.close();\n        } catch (e) {\n            // Ignore.\n        }\n    }\n\n    public static on(eventType: EventType, listener: EventListener): void {\n        LedgerApi._observable.on(eventType, listener);\n    }\n\n    public static off(eventType: EventType, listener: EventListener): void {\n        LedgerApi._observable.off(eventType, listener);\n    }\n\n    public static once(eventType: EventType, listener: EventListener): void {\n        LedgerApi._observable.once(eventType, listener);\n    }\n\n    // private fields and methods\n    private static _transportType: TransportType | null = autoDetectTransportTypeToUse();\n    private static _transportPromise: Promise<Transport> | null = null;\n    private static _currentState: State = { type: StateType.IDLE };\n    private static _currentRequest: Request | null = null;\n    private static _currentConnection: CoinAppConnection | null = null;\n    private static _connectionAborted: boolean = false;\n    private static readonly _observable = new Observable();\n\n    private static async _createRequest<RC extends RequestConstructor>(\n        requestConstructor: (new (...params: ConstructorParameters<RC>) => InstanceType<RC>)\n        | Promise<{ default: new (...params: ConstructorParameters<RC>) => InstanceType<RC> }>,\n        ...params: ConstructorParameters<RC>\n    ): Promise<InstanceType<RC>> {\n        if (LedgerApi.transportType) {\n            // Prepare transport dependency in parallel. Ignore errors as it's just a preparation.\n            loadTransportLibrary(LedgerApi.transportType).catch(() => {});\n        }\n\n        if (requestConstructor instanceof Promise) {\n            try {\n                requestConstructor = (await requestConstructor).default;\n            } catch (e) {\n                const error = new ErrorState(\n                    ErrorType.LOADING_DEPENDENCIES_FAILED,\n                    `Failed loading dependencies: ${e instanceof Error ? e.message : e}`,\n                    undefined,\n                );\n                LedgerApi._setState(error);\n                throw error;\n            }\n        }\n\n        try {\n            // Note that the requestConstructor is typed as is instead of just RC | Promise<{ default: RC }> such that\n            // typescript can determine which exact request is being created and returned.\n            return new requestConstructor(...params); // eslint-disable-line new-cap\n        } catch (e) {\n            if (e instanceof ErrorState) {\n                LedgerApi._setState(e);\n            }\n            throw e;\n        }\n    }\n\n    private static async _callLedger<R extends Request>(request: R): Promise<ReturnType<R['call']>> {\n        if (LedgerApi.isBusy) {\n            const error = new ErrorState(ErrorType.LEDGER_BUSY, 'Only one call to Ledger at a time allowed', request);\n            LedgerApi._setState(error);\n            throw error;\n        }\n        LedgerApi._connectionAborted = false; // user is initiating a new request\n        try {\n            LedgerApi._currentRequest = request;\n            /* eslint-disable no-await-in-loop, no-async-promise-executor */\n            return await new Promise<ReturnType<R['call']>>(async (resolve, reject) => {\n                let lastRequestCallTime = -1;\n                let canCancelDirectly = true;\n                let cancelFired = false;\n                request.on(REQUEST_EVENT_CANCEL, () => {\n                    // If we can, reject the call right away. Otherwise just notify that the request was requested to be\n                    // cancelled such that the user can cancel the call on the ledger.\n                    if (canCancelDirectly) {\n                        // Note that !!_currentConnection is not an indicator that we can cancel directly, as it's just\n                        // an estimate and we might not actually be disconnected or the request might already have been\n                        // sent before disconnecting.\n                        if (!cancelFired) {\n                            LedgerApi._fire(EventType.REQUEST_CANCELLED, request);\n                            cancelFired = true;\n                        }\n                        reject(new Error('Request cancelled'));\n                    } else {\n                        LedgerApi._setState(StateType.REQUEST_CANCELLING);\n                    }\n                });\n                while (!request.cancelled) {\n                    try {\n                        const transport = await LedgerApi._getTransport(request);\n                        if (request.cancelled) break;\n                        await LedgerApi._connect(transport, request);\n                        if (request.cancelled) break;\n                        LedgerApi._setState(StateType.REQUEST_PROCESSING);\n                        lastRequestCallTime = Date.now();\n                        canCancelDirectly = false; // sending request which has to be resolved / cancelled by the Ledger\n                        const result = await request.call(transport);\n                        if (request.cancelled) break;\n                        LedgerApi._fire(EventType.REQUEST_SUCCESSFUL, request, result);\n                        resolve(result as any);\n                        return;\n                    } catch (e) {\n                        console.debug(e);\n                        if (e instanceof ErrorState) {\n                            LedgerApi._setState(e);\n                        }\n\n                        const message = (e instanceof Error ? e.message : String(e)).toLowerCase();\n                        // \"timeout\" used to happen for u2f, it's \"device_ineligible\" or \"other_error\" now (see\n                        // transport-comparison.md). \"timed out\" is for Chrome WebAuthn timeout; \"denied permission\" for\n                        // Firefox WebAuthn timeout.\n                        const isTimeout = /timeout|timed out|denied permission|u2f device_ineligible|u2f other_error/i\n                            .test(message);\n                        const isLocked = /locked|0x6804/i.test(message);\n                        const isConnectedToDashboard = /incorrect length/i.test(message);\n                        canCancelDirectly = canCancelDirectly || isTimeout || isConnectedToDashboard;\n                        if (LedgerApi._transportType === TransportType.U2F\n                            || LedgerApi._transportType === TransportType.WEB_AUTHN\n                            || isLocked) {\n                            // For u2f / webauthn we don't get notified about disconnects therefore clear connection on\n                            // every exception. When locked clear connection for all transport types as user might\n                            // unlock with a different PIN for another wallet.\n                            LedgerApi._currentConnection = null;\n                        }\n                        // Test whether user cancelled call on ledger device or in WebAuthn / U2F browser popup\n                        if (message.indexOf('denied by the user') !== -1 // user rejected confirmAddress on device\n                            || message.indexOf('request was rejected') !== -1 // user rejected signTransaction on device\n                            || (LedgerApi._isWebAuthnOrU2fCancellation(message, lastRequestCallTime)\n                                && !LedgerApi._connectionAborted)\n                        ) {\n                            // Note that on _isWebAuthnOrU2fCancellation we can cancel directly and don't need the user\n                            // to cancel the request on the device as Ledger Nano S is now able to clean up old WebAuthn\n                            // and U2F requests and the the Nano X lets the Nimiq App crash anyways after the WebAuthn /\n                            // U2F host was lost. If the web authn / u2f cancellation was during connect and caused\n                            // _connectionAborted, don't cancel the request.\n                            canCancelDirectly = true;\n                            request.cancel(); // in case the request was not marked as cancelled before\n                            break; // continue after loop where the actual cancellation happens\n                        }\n                        // Errors that should end the request\n                        if ((LedgerApi.currentState instanceof ErrorState\n                            && LedgerApi.currentState.errorType === ErrorType.REQUEST_ASSERTION_FAILED)\n                            || message.indexOf('not supported') !== -1) { // no browser support\n                            reject(e);\n                            return;\n                        }\n                        // On other errors try again\n                        if (!/busy|outdated|connection aborted|user gesture|dependencies|wrong app|wrong wallet/i\n                            .test(message)\n                            && !isTimeout && !isLocked && !isConnectedToDashboard) {\n                            console.warn('Unknown Ledger Error', e);\n                        }\n                        // Wait a little when replacing a previous U2F request (see transport-comparison.md).\n                        const waitTime = isTimeout ? LedgerApi.WAIT_TIME_AFTER_TIMEOUT\n                            // If the API tells us that the ledger is busy (see transport-comparison.md) use a longer\n                            // wait time to reduce the chance that we hit unfortunate 1.5s window after timeout of\n                            // cancelled call\n                            : message.indexOf('busy') !== -1 ? 4 * LedgerApi.WAIT_TIME_AFTER_TIMEOUT\n                                // For other exceptions wait a little to avoid busy endless loop for some exceptions.\n                                : LedgerApi.WAIT_TIME_AFTER_ERROR;\n                        await new Promise((resolve2) => setTimeout(resolve2, waitTime));\n                    }\n                }\n                if (!cancelFired) {\n                    LedgerApi._fire(EventType.REQUEST_CANCELLED, request);\n                    cancelFired = true;\n                }\n                reject(new Error('Request cancelled'));\n            });\n            /* eslint-enable no-await-in-loop, no-async-promise-executor */\n        } finally {\n            LedgerApi._currentRequest = null;\n            if (LedgerApi._transportType === TransportType.U2F\n                || LedgerApi._transportType === TransportType.WEB_AUTHN) {\n                LedgerApi._currentConnection = null; // reset as we don't note when Ledger gets disconnected\n            }\n            const errorType = LedgerApi._currentState instanceof ErrorState\n                ? LedgerApi._currentState.errorType\n                : null;\n            if (errorType !== ErrorType.BROWSER_UNSUPPORTED\n                && errorType !== ErrorType.REQUEST_ASSERTION_FAILED) {\n                LedgerApi._setState(StateType.IDLE);\n            }\n        }\n    }\n\n    private static async _connect(transport: Transport, request: Request): Promise<Transport> {\n        // Resolves when connected to unlocked ledger with open coin app otherwise throws an exception after timeout,\n        // in contrast to the public connect method which just listens for a connection or uses getWalletId to try to\n        // connect repeatedly until success via _callLedger which uses the private _connect under the hood. Also this\n        // method is not publicly exposed to avoid that it could be invoked multiple times in parallel which the ledger\n        // requests called here do not allow.\n\n        // Establish / verify the connection.\n        // This takes <300ms for a pre-authorized device via WebUSB, WebHID or WebBLE and <1s for WebAuthn or U2F.\n        if (!LedgerApi._currentConnection || !request.canReuseCoinAppConnection(LedgerApi._currentConnection)) {\n            const connectStart = Date.now();\n            LedgerApi._setState(StateType.CONNECTING);\n            LedgerApi._currentConnection = null;\n\n            try {\n                LedgerApi._currentConnection = await request.checkCoinAppConnection(transport);\n            } catch (e) {\n                const message = (e instanceof Error ? e.message : String(e)).toLowerCase();\n                if (message.indexOf('busy') !== -1) {\n                    throw new ErrorState(\n                        ErrorType.LEDGER_BUSY,\n                        // important to rethrow original message for handling of the 'busy' keyword in _callLedger\n                        `Only one call to Ledger at a time allowed: ${e}`,\n                        request,\n                    );\n                } else if (LedgerApi._isWebAuthnOrU2fCancellation(message, connectStart)) {\n                    LedgerApi._connectionAborted = true;\n                    throw new ErrorState(\n                        ErrorType.CONNECTION_ABORTED,\n                        `Connection aborted: ${message}`,\n                        request,\n                    );\n                }\n\n                // Rethrow other errors that just keep the API retrying (like timeout, dongle locked) or error states.\n                throw e;\n            }\n        }\n\n        LedgerApi._fire(EventType.CONNECTED, LedgerApi._currentConnection);\n        return transport;\n    }\n\n    private static async _getTransport(request: Request): Promise<Transport> {\n        if (LedgerApi._connectionAborted) {\n            // When the connection was aborted, don't retry creating a transport until a manual connection is requested.\n            // Throw as normal error and not as error state as error state had already been reported.\n            throw new Error('Connection aborted');\n        }\n\n        // Create transport. Note that creating the transport has to happen in the context of a user interaction if\n        // opening a device selector is required.\n        const transportType = LedgerApi._transportType;\n        LedgerApi._transportPromise = LedgerApi._transportPromise || (async () => {\n            // Check browser support for current transport. Note that when transport changes during connect, we recurse.\n            if (!transportType || !isSupported(transportType)) {\n                throw new ErrorState(\n                    ErrorType.BROWSER_UNSUPPORTED,\n                    'Ledger not supported by browser.',\n                    request,\n                );\n            }\n\n            // Load transport lib.\n            let TransportLib: TransportWebUsbConstructor | TransportConstructor;\n            // Only set the loading state if the lib is not already loaded or fails instantly.\n            const delayedLoadingStateTimeout = setTimeout(() => LedgerApi._setState(StateType.LOADING), 50);\n            try {\n                TransportLib = await loadTransportLibrary(transportType!);\n            } catch (e) {\n                if (transportType === LedgerApi._transportType) {\n                    throw new ErrorState(\n                        ErrorType.LOADING_DEPENDENCIES_FAILED,\n                        `Failed loading dependencies: ${e instanceof Error ? e.message : e}`,\n                        request,\n                    );\n                }\n            } finally {\n                clearTimeout(delayedLoadingStateTimeout);\n            }\n            if (transportType !== LedgerApi._transportType) throw new Error('Transport changed'); // caught locally\n\n            let transport: Transport;\n            // Only set the connecting state if it is not instantaneous because a device selector needs to be shown\n            const delayedConnectingStateTimeout = setTimeout(() => LedgerApi._setState(StateType.CONNECTING), 50);\n            try {\n                transport = await TransportLib!.create(\n                    undefined, // use default openTimeout\n                    // For network transport set a listenTimeout to avoid pinging the network endpoint indefinitely.\n                    // Others can be cancelled by the user when he wants or can not listen to devices getting connected\n                    // (u2f, WebAuthn) such that we don't have to put a timeout in place for other transport types.\n                    transportType === TransportType.NETWORK ? 3000 : undefined,\n                );\n            } catch (e) {\n                if (transportType === LedgerApi._transportType) {\n                    const message = (e instanceof Error ? e.message : String(e)).toLowerCase();\n                    if (/no device selected|access denied|cancelled the requestdevice/i.test(message)) {\n                        LedgerApi._connectionAborted = true;\n                        throw new ErrorState(\n                            ErrorType.CONNECTION_ABORTED,\n                            `Connection aborted: ${message}`,\n                            request,\n                        );\n                    } else if (message.indexOf('user gesture') !== -1) {\n                        throw new ErrorState(\n                            ErrorType.USER_INTERACTION_REQUIRED,\n                            e instanceof Error ? e : String(e),\n                            request,\n                        );\n                    } else {\n                        throw e; // rethrow unknown exception\n                    }\n                }\n            } finally {\n                clearTimeout(delayedConnectingStateTimeout);\n            }\n            if (transportType !== LedgerApi._transportType) {\n                transport!.close();\n                throw new Error('Transport changed'); // caught locally\n            }\n\n            const onDisconnect = () => {\n                console.debug('Ledger disconnected');\n                transport.off('disconnect', onDisconnect);\n                if (transportType === LedgerApi._transportType) {\n                    // Disconnected transport cannot be reconnected. Thus also disconnect from our side for cleanup.\n                    // If the transport switched, no additional cleanup is necessary as it already happened on switch.\n                    LedgerApi.disconnect(/* cancelRequest */ false);\n                }\n            };\n            transport!.on('disconnect', onDisconnect);\n\n            return transport!;\n        })();\n\n        try {\n            return await LedgerApi._transportPromise;\n        } catch (e) {\n            LedgerApi._transportPromise = null;\n            if (transportType === LedgerApi._transportType) throw e;\n            // Transport type changed while we were connecting; ignore error and rerun\n            return LedgerApi._getTransport(request);\n        }\n    }\n\n    private static _isWebAuthnOrU2fCancellation(errorMessage: string, requestStart: number) {\n        // Try to detect a WebAuthn or U2F cancellation. In Firefox, we can detect a WebAuthn cancellation for the\n        // Firefox internal popup. However, Firefox U2F cancellations, Firefox WebAuthn cancellations via Window's\n        // native popup and Chrome WebAuthn cancellations are not distinguishable from timeouts, therefore we check\n        // how likely it is a timeout by the passed time since request start.\n        return /operation was aborted/i.test(errorMessage) // WebAuthn cancellation in Firefox internal popup\n            || (/timed out|denied permission|u2f other_error/i.test(errorMessage) && Date.now() - requestStart < 20000);\n    }\n\n    private static _setState(state: State | Exclude<StateType, StateType.ERROR>): void {\n        if (typeof state === 'string') {\n            // it's an entry from LedgerApi.StateType enum\n            state = { type: state } as State;\n        }\n        state.request = !state.request && LedgerApi._currentRequest ? LedgerApi._currentRequest : state.request;\n\n        const currentState = LedgerApi._currentState;\n        const currentErrorType = currentState instanceof ErrorState ? currentState.errorType : null;\n        const errorType = state instanceof ErrorState ? state.errorType : null;\n        if (currentState.type === state.type\n            && currentErrorType === errorType\n            && LedgerApi._currentState.request === state.request) return;\n        LedgerApi._currentState = state;\n        LedgerApi._fire(EventType.STATE_CHANGE, state);\n    }\n\n    private static _fire(eventName: EventType, ...args: any[]): void {\n        LedgerApi._observable.fire(eventName, ...args);\n    }\n}\n"],"names":[],"mappings":"AAEc,MAAO,UAAU,CAAA;AACnB,IAAA,UAAU,GAAiC,IAAI,GAAG,EAAE,CAAC;IAEtD,EAAE,CAAC,SAAiB,EAAE,QAAuB,EAAA;QAChD,IAAI,CAAC,IAAI,CAAC,UAAU,CAAC,GAAG,CAAC,SAAS,CAAC,EAAE;YACjC,IAAI,CAAC,UAAU,CAAC,GAAG,CAAC,SAAS,EAAE,CAAC,QAAQ,CAAC,CAAC,CAAC;AAC9C,SAAA;AAAM,aAAA;AACH,YAAA,IAAI,CAAC,UAAU,CAAC,GAAG,CAAC,SAAS,CAAE,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;AAClD,SAAA;KACJ;IAEM,GAAG,CAAC,SAAiB,EAAE,QAAuB,EAAA;QACjD,MAAM,iBAAiB,GAAG,IAAI,CAAC,UAAU,CAAC,GAAG,CAAC,SAAS,CAAC,CAAC;AACzD,QAAA,IAAI,CAAC,iBAAiB;YAAE,OAAO;QAC/B,MAAM,KAAK,GAAG,iBAAiB,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC;QAClD,IAAI,KAAK,KAAK,CAAC,CAAC;YAAE,OAAO;AACzB,QAAA,iBAAiB,CAAC,MAAM,CAAC,KAAK,EAAE,CAAC,CAAC,CAAC;KACtC;IAEM,IAAI,CAAC,SAAiB,EAAE,QAAuB,EAAA;AAClD,QAAA,MAAM,YAAY,IAAmB,CAAC,GAAG,IAAW,KAAI;AACpD,YAAA,IAAI,CAAC,GAAG,CAAC,SAAS,EAAE,YAAY,CAAC,CAAC;AAClC,YAAA,QAAQ,CAAC,GAAG,IAAI,CAAC,CAAC;AACtB,SAAC,CAAC,CAAC;AACH,QAAA,IAAI,CAAC,EAAE,CAAC,SAAS,EAAE,YAAY,CAAC,CAAC;KACpC;AAEM,IAAA,IAAI,CAAC,SAAiB,EAAE,GAAG,IAAW,EAAA;;QAEzC,UAAU,CAAC,MAAK;YACZ,MAAM,iBAAiB,GAAG,IAAI,CAAC,UAAU,CAAC,GAAG,CAAC,SAAS,CAAC,CAAC;AACzD,YAAA,IAAI,CAAC,iBAAiB;gBAAE,OAAO;AAC/B,YAAA,KAAK,MAAM,QAAQ,IAAI,iBAAiB,EAAE;AACtC,gBAAA,QAAQ,CAAC,GAAG,IAAI,CAAC,CAAC;AACrB,aAAA;SACJ,EAAE,CAAC,CAAC,CAAC;KACT;AACJ;;ACvCD;AACA;AACA;IAEY,aAGX;AAHD,CAAA,UAAY,YAAY,EAAA;AACpB,IAAA,YAAA,CAAA,WAAA,CAAA,GAAA,WAAuB,CAAA;AACvB,IAAA,YAAA,CAAA,QAAA,CAAA,GAAA,QAAiB,CAAA;AACrB,CAAC,EAHW,YAAY,KAAZ,YAAY,GAGvB,EAAA,CAAA,CAAA;;ACPD;IAKY,cAOX;AAPD,CAAA,UAAY,aAAa,EAAA;AACrB,IAAA,aAAA,CAAA,SAAA,CAAA,GAAA,SAAmB,CAAA;AACnB,IAAA,aAAA,CAAA,SAAA,CAAA,GAAA,SAAmB,CAAA;AACnB,IAAA,aAAA,CAAA,SAAA,CAAA,GAAA,SAAmB,CAAA;AACnB,IAAA,aAAA,CAAA,WAAA,CAAA,GAAA,WAAuB,CAAA;AACvB,IAAA,aAAA,CAAA,KAAA,CAAA,GAAA,KAAW,CAAA;AACX,IAAA,aAAA,CAAA,SAAA,CAAA,GAAA,SAAmB,CAAA;AACvB,CAAC,EAPW,aAAa,KAAb,aAAa,GAOxB,EAAA,CAAA,CAAA,CAAA;AAEK,SAAU,WAAW,CAAC,aAA6B,EAAA;AACrD,IAAA,IAAI,CAAC,aAAa;AAAE,QAAA,OAAO,CAAC,CAAC,4BAA4B,EAAE,CAAC;AAC5D,IAAA,IAAI,aAAa,KAAK,aAAa,CAAC,OAAO,IAAI,MAAM,CAAC,QAAQ,CAAC,QAAQ,KAAK,QAAQ;AAAE,QAAA,OAAO,KAAK,CAAC;;AAEnG,IAAA,QAAQ,aAAa;QACjB,KAAK,aAAa,CAAC,OAAO;AACtB,YAAA,OAAO,KAAK,IAAI,MAAM,CAAC,SAAS,CAAC;QACrC,KAAK,aAAa,CAAC,OAAO;;AAEtB,YAAA,OAAO,KAAK,IAAI,MAAM,CAAC,SAAS,IAAI,OAAO,MAAM,CAAC,SAAS,CAAC,GAAG,CAAC,UAAU,KAAK,UAAU,CAAC;QAC9F,KAAK,aAAa,CAAC,OAAO;AACtB,YAAA,OAAO,WAAW,IAAI,MAAM,CAAC,SAAS,CAAC;QAC3C,KAAK,aAAa,CAAC,SAAS;AACxB,YAAA,OAAO,CAAC,CAAC,SAAS,CAAC,WAAW,CAAC;QACnC,KAAK,aAAa,CAAC,GAAG;;;;;;;AAOlB,YAAA,OAAO,KAAK,IAAI,MAAM,IAAI,OAAO,MAAM,CAAC,GAAG,CAAC,IAAI,KAAK,UAAU,CAAC;QACpE,KAAK,aAAa,CAAC,OAAO;AACtB,YAAA,OAAO,OAAO,IAAI,MAAM,IAAI,WAAW,IAAI,MAAM,CAAC;AACtD,QAAA;AACI,YAAA,OAAO,KAAK,CAAC;AACpB,KAAA;AACL,CAAC;SAEe,4BAA4B,GAAA;;;;AAIxC,IAAA,MAAM,0BAA0B,GAAG;;;AAG/B,QAAA,aAAa,CAAC,OAAO;;AAErB,QAAA,aAAa,CAAC,OAAO;;;;;AAKrB,QAAA,aAAa,CAAC,SAAS;;AAEvB,QAAA,aAAa,CAAC,GAAG;KACpB,CAAC;IACF,OAAO,0BAA0B,CAAC,IAAI,CAAC,WAAW,CAAC,IAAI,IAAI,CAAC;AAChE,CAAC;AAED,IAAI,eAAe,GAAW,qBAAqB,CAAC;AAEpD;;;AAGG;AACG,SAAU,kBAAkB,CAAC,QAAgB,EAAA;IAC/C,eAAe,GAAG,QAAQ,CAAC;AAC/B,CAAC;SAEe,kBAAkB,GAAA;AAC9B,IAAA,OAAO,eAAe,CAAC;AAC3B,CAAC;AAED;;;AAGG;AACI,eAAe,oBAAoB,CAAC,aAA4B,EAAA;AAEnE,IAAA,QAAQ,aAAa;QACjB,KAAK,aAAa,CAAC,OAAO;YACtB,OAAO,CAAC,MAAM,OAAO,oCAA+B,CAAC,EAAE,OAAO,CAAC;QACnE,KAAK,aAAa,CAAC,OAAO;YACtB,OAAO,CAAC,MAAM,OAAO,oCAA+B,CAAC,EAAE,OAAO,CAAC;QACnE,KAAK,aAAa,CAAC,OAAO;YACtB,OAAO,CAAC,MAAM,OAAO,oCAAgC,CAAC,EAAE,OAAO,CAAC;QACpE,KAAK,aAAa,CAAC,SAAS;YACxB,OAAO,CAAC,MAAM,OAAO,sCAAiC,CAAC,EAAE,OAAO,CAAC;QACrE,KAAK,aAAa,CAAC,GAAG;YAClB,OAAO,CAAC,MAAM,OAAO,iCAA4B,CAAC,EAAE,OAAO,CAAC;QAChE,KAAK,aAAa,CAAC,OAAO;AACtB,YAAA,OAAO,CAAC,MAAM,OAAO,mCAA6B,CAAC,EAAE,OAAO,CAAC,CAAC,eAAe,CAAC,CAAC,CAAC;AACpF,QAAA;AACI,YAAA,MAAM,IAAI,KAAK,CAAC,0BAA0B,aAAa,CAAA,CAAE,CAAC,CAAC;AAClE,KAAA;AACL;;ACpGM,SAAU,cAAc,CAC1B,GAAW,EACX,WAAmB,EACnB,cAAuB,EACvB,aAAsB,EAAA;IAEtB,OAAO,GAAG,KAAK,WAAW;YAClB,cAAc,IAAI,GAAG,KAAK,YAAY,CAAC,WAAW,CAAC,CAAC;YACpD,aAAa,IAAI,GAAG,KAAK,KAAK,CAAC,CAAC;AAC5C,CAAC;AAEe,SAAA,qBAAqB,CAAC,aAAqB,EAAE,kBAA0B,EAAA;IACnF,MAAM,OAAO,GAAG,aAAa,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,GAAG,CAAC,CAAC,IAAI,KAAK,QAAQ,CAAC,IAAI,EAAE,EAAE,CAAC,CAAC,CAAC;IAC3E,MAAM,wBAAwB,GAAG,kBAAkB,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,GAAG,CAAC,CAAC,IAAI,KAAK,QAAQ,CAAC,IAAI,EAAE,EAAE,CAAC,CAAC,CAAC;AACjG,IAAA,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,kBAAkB,CAAC,MAAM,EAAE,EAAE,CAAC,EAAE;AAChD,QAAA,IAAI,OAAO,OAAO,CAAC,CAAC,CAAC,KAAK,WAAW,IAAI,OAAO,CAAC,CAAC,CAAC,GAAG,wBAAwB,CAAC,CAAC,CAAC;AAAE,YAAA,OAAO,KAAK,CAAC;QAChG,IAAI,OAAO,CAAC,CAAC,CAAC,GAAG,wBAAwB,CAAC,CAAC,CAAC;AAAE,YAAA,OAAO,IAAI,CAAC;AAC7D,KAAA;AACD,IAAA,OAAO,IAAI,CAAC;AAChB,CAAC;AAEK,SAAU,WAAW,CAAC,GAAW,EAAA;AACnC,IAAA,OAAO,GAAG,CAAC,QAAQ,CAAC,SAAS,CAAC,CAAC;AACnC,CAAC;AAEK,SAAU,YAAY,CAAC,GAAW,EAAA;;IAEpC,OAAO,GAAG,CAAC,OAAO,CAAC,eAAe,EAAE,SAAS,CAAC,CAAC;AACnD;;AC5BA;AACA;AACA;IAIY,KAGX;AAHD,CAAA,UAAY,IAAI,EAAA;AACZ,IAAA,IAAA,CAAA,OAAA,CAAA,GAAA,OAAe,CAAA;AACf,IAAA,IAAA,CAAA,SAAA,CAAA,GAAA,SAAmB,CAAA;AACvB,CAAC,EAHW,IAAI,KAAJ,IAAI,GAGf,EAAA,CAAA,CAAA,CAAA;IAEW,QAIX;AAJD,CAAA,UAAY,OAAO,EAAA;AACf,IAAA,OAAA,CAAA,SAAA,CAAA,GAAA,MAAgB,CAAA;AAChB,IAAA,OAAA,CAAA,SAAA,CAAA,GAAA,MAAgB,CAAA;AAChB,IAAA,OAAA,CAAA,QAAA,CAAA,GAAA,KAAc,CAAA;AAClB,CAAC,EAJW,OAAO,KAAP,OAAO,GAIlB,EAAA,CAAA,CAAA,CAAA;AAED;AACa,MAAA,cAAc,GAAG;AAC1B,IAAA,CAAC,OAAO,CAAC,OAAO,GAAG,EAAE;AACrB,IAAA,CAAC,OAAO,CAAC,OAAO,GAAG,CAAC;AACpB,IAAA,CAAC,OAAO,CAAC,MAAM,GAAG,CAAC;AACnB,IAAA,CAAC,YAAY,CAAC,MAAM,GAAG;AACnB,QAAA,CAAC,OAAO,CAAC,OAAO,GAAG,EAAE;AACrB,QAAA,CAAC,OAAO,CAAC,OAAO,GAAG,CAAC;AACpB,QAAA,CAAC,OAAO,CAAC,MAAM,GAAG,CAAC;AACtB,KAAA;EACM;AAEX;AACA;IACY,iBAKX;AALD,CAAA,UAAY,gBAAgB,EAAA;AACxB,IAAA,gBAAA,CAAA,gBAAA,CAAA,OAAA,CAAA,GAAA,CAAA,CAAA,GAAA,OAAS,CAAA;AACT,IAAA,gBAAA,CAAA,gBAAA,CAAA,SAAA,CAAA,GAAA,CAAA,CAAA,GAAA,SAAW,CAAA;AACX,IAAA,gBAAA,CAAA,gBAAA,CAAA,MAAA,CAAA,GAAA,CAAA,CAAA,GAAA,MAAQ,CAAA;AACR,IAAA,gBAAA,CAAA,gBAAA,CAAA,SAAA,CAAA,GAAA,CAAA,CAAA,GAAA,SAAW,CAAA;AACf,CAAC,EALW,gBAAgB,KAAhB,gBAAgB,GAK3B,EAAA,CAAA,CAAA,CAAA;AAED;IACY,sBAIX;AAJD,CAAA,UAAY,qBAAqB,EAAA;AAC7B,IAAA,qBAAA,CAAA,qBAAA,CAAA,MAAA,CAAA,GAAA,CAAA,CAAA,GAAA,MAAU,CAAA;AACV,IAAA,qBAAA,CAAA,qBAAA,CAAA,mBAAA,CAAA,GAAA,CAAA,CAAA,GAAA,mBAAuB,CAAA;AACvB,IAAA,qBAAA,CAAA,qBAAA,CAAA,WAAA,CAAA,GAAA,CAAA,CAAA,GAAA,WAAgB,CAAA;AACpB,CAAC,EAJW,qBAAqB,KAArB,qBAAqB,GAIhC,EAAA,CAAA,CAAA,CAAA;IAEW,mBAIX;AAJD,CAAA,UAAY,kBAAkB,EAAA;AAC1B,IAAA,kBAAA,CAAA,QAAA,CAAA,GAAA,gBAAyB,CAAA;AACzB,IAAA,kBAAA,CAAA,aAAA,CAAA,GAAA,qBAAmC,CAAA;AACnC,IAAA,kBAAA,CAAA,eAAA,CAAA,GAAA,uBAAuC,CAAA;AAC3C,CAAC,EAJW,kBAAkB,KAAlB,kBAAkB,GAI7B,EAAA,CAAA,CAAA,CAAA;AAEY,MAAA,6BAA6B,GAAG;AACzC,IAAA,CAAC,kBAAkB,CAAC,MAAM,GAAG,QAAoB;AACjD,IAAA,CAAC,kBAAkB,CAAC,WAAW,GAAG,MAAgB;AAClD,IAAA,CAAC,kBAAkB,CAAC,aAAa,GAAG,QAAoB;EAC1D;AAEK,MAAM,oBAAoB,GAAG,SAAS;IAEjC,iBAOX;AAPD,CAAA,UAAY,gBAAgB,EAAA;AACxB,IAAA,gBAAA,CAAA,eAAA,CAAA,GAAA,qBAAqC,CAAA;AACrC,IAAA,gBAAA,CAAA,kBAAA,CAAA,GAAA,wBAA2C,CAAA;AAC3C,IAAA,gBAAA,CAAA,gBAAA,CAAA,GAAA,sBAAuC,CAAA;AACvC,IAAA,gBAAA,CAAA,aAAA,CAAA,GAAA,mBAAiC,CAAA;AACjC,IAAA,gBAAA,CAAA,kBAAA,CAAA,GAAA,wBAA2C,CAAA;AAC3C,IAAA,gBAAA,CAAA,cAAA,CAAA,GAAA,oBAAmC,CAAA;AACvC,CAAC,EAPW,gBAAgB,KAAhB,gBAAgB,GAO3B,EAAA,CAAA,CAAA,CAAA;IAEW,mBAMX;AAND,CAAA,UAAY,kBAAkB,EAAA;AAC1B,IAAA,kBAAA,CAAA,eAAA,CAAA,GAAA,uBAAuC,CAAA;AACvC,IAAA,kBAAA,CAAA,4BAAA,CAAA,GAAA,oCAAiE,CAAA;AACjE,IAAA,kBAAA,CAAA,yBAAA,CAAA,GAAA,iCAA2D,CAAA;AAC3D,IAAA,kBAAA,CAAA,kBAAA,CAAA,GAAA,0BAA6C,CAAA;AAC7C,IAAA,kBAAA,CAAA,cAAA,CAAA,GAAA,sBAAqC,CAAA;AACzC,CAAC,EANW,kBAAkB,KAAlB,kBAAkB,GAM7B,EAAA,CAAA,CAAA;;AC5DD;AACA,MAAM,UAAU,GAAG,IAAI,MAAM,CACzB,GAAG;AACD,MAAA,SAAS;AACT,MAAA,WAAW;AACX,MAAA,WAAW;AACX,MAAA,WAAW;AACX,MAAA,cAAc;AACd,MAAA,aAAa;AACb,MAAA,GAAG,CACR,CAAC;AAEF,MAAM,sBAAsB,GAAG,IAAI,GAAG,CAA6B;AAC/D,IAAA,CAAC,kBAAkB,CAAC,MAAM,EAAE,EAAE,CAAC;AAC/B,IAAA,CAAC,kBAAkB,CAAC,WAAW,EAAE,EAAE,CAAC;AACpC,IAAA,CAAC,kBAAkB,CAAC,aAAa,EAAE,EAAE,CAAC;AACzC,CAAA,CAAC,CAAC;AAEH;;AAEG;AACG,SAAU,YAAY,CAAC,MAAuB,EAAA;;AAEhD,IAAA,MAAM,GAAG;AACL,QAAA,YAAY,EAAE,CAAC;AACf,QAAA,GAAG,MAAM;KACZ,CAAC;IACF,QAAQ,MAAM,CAAC,IAAI;QACf,KAAK,IAAI,CAAC,KAAK;YACX,OAAO,CAAA,SAAA,EAAY,MAAM,CAAC,YAAY,CAAA,EAAA,EAAK,MAAM,CAAC,YAAY,CAAA,CAAA,CAAG,CAAC;AACtE,QAAA,KAAK,IAAI,CAAC,OAAO,EAAE;;AAEf,YAAA,MAAM,GAAG;gBACL,WAAW,EAAE,kBAAkB,CAAC,aAAa;gBAC7C,OAAO,EAAE,OAAO,CAAC,OAAO;AACxB,gBAAA,UAAU,EAAE,KAAK;AACjB,gBAAA,GAAG,MAAM;aACZ,CAAC;YACF,MAAM,SAAS,GAAG,sBAAsB,CAAC,GAAG,CAAC,MAAM,CAAC,WAAY,CAAC,CAAC;AAClE,YAAA,MAAM,QAAQ,GAAG,MAAM,CAAC,OAAO,KAAK,OAAO,CAAC,OAAO,GAAG,CAAC,GAAG,CAAC,CAAC;AAC5D,YAAA,MAAM,UAAU,GAAG,MAAM,CAAC,UAAU,GAAG,CAAC,GAAG,CAAC,CAAC;AAC7C,YAAA,OAAO,CAAG,EAAA,SAAS,CAAK,EAAA,EAAA,QAAQ,KAAK,MAAM,CAAC,YAAY,CAAA,EAAA,EAAK,UAAU,CAAI,CAAA,EAAA,MAAM,CAAC,YAAY,EAAE,CAAC;AACpG,SAAA;AACD,QAAA;YACI,MAAM,IAAI,KAAK,CAAC,CAAA,kBAAA,EAAsB,MAAc,CAAC,IAAI,CAAE,CAAA,CAAC,CAAC;AACpE,KAAA;AACL,CAAC;AAED;;AAEG;AACG,SAAU,cAAc,CAAC,IAAY,EAAA;IACvC,MAAM,SAAS,GAAG,IAAI,CAAC,KAAK,CAAC,UAAU,CAAC,CAAC;AACzC,IAAA,IAAI,CAAC,SAAS;AAAE,QAAA,MAAM,IAAI,KAAK,CAAC,GAAG,IAAI,CAAA,+BAAA,CAAiC,CAAC,CAAC;IAC1E,MAAM,SAAS,GAAG,QAAQ,CAAC,SAAS,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC;IAC7C,MAAM,QAAQ,GAAG,QAAQ,CAAC,SAAS,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC;IAC5C,MAAM,YAAY,GAAG,QAAQ,CAAC,SAAS,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC;AAChD,IAAA,MAAM,UAAU,GAAG,SAAS,CAAC,CAAC,CAAC,CAAC;IAChC,MAAM,YAAY,GAAG,QAAQ,CAAC,SAAS,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC;IAChD,MAAM,sBAAsB,GAAG,CAAC,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC;;;IAI9C,IAAI,YAAY,IAAI,CAAC,IAAI,EAAE,IAAI,YAAY,IAAI,CAAC,IAAI,EAAE;AAAE,QAAA,MAAM,IAAI,KAAK,CAAC,eAAe,CAAC,CAAC;IAEzF,MAAM,WAAW,GAAG,CAAG,EAAA,SAAS,KAAK,QAAQ,CAAA,EAAA,EAAK,YAAY,CAAA,CAAA,CAAG,CAAC;AAClE,IAAA,QAAQ,QAAQ;AACZ,QAAA,KAAK,GAAG;;YAEJ,IAAI,SAAS,KAAK,EAAE;AAAE,gBAAA,MAAM,IAAI,KAAK,CAAC,iCAAiC,CAAC,CAAC;YACzE,IAAI,UAAU,KAAK,SAAS;AAAE,gBAAA,MAAM,IAAI,KAAK,CAAC,qDAAqD,CAAC,CAAC;AACrG,YAAA,IAAI,CAAC,sBAAsB;AAAE,gBAAA,MAAM,IAAI,KAAK,CAAC,0CAA0C,CAAC,CAAC;YACzF,OAAO;gBACH,IAAI,EAAE,IAAI,CAAC,KAAK;gBAChB,YAAY;gBACZ,YAAY;gBACZ,WAAW;aACd,CAAC;AACN,QAAA,KAAK,CAAC,CAAC;QACP,KAAK,CAAC,EAAE;;YAEJ,MAAM,eAAe,GAAG,CAAC,GAAG,sBAAsB,CAAC,MAAM,EAAE,CAAC,CAAC;AAC7D,YAAA,IAAI,CAAC,eAAe,CAAC,QAAQ,CAAC,SAAS,CAAC;AAAE,gBAAA,MAAM,IAAI,KAAK,CAAC,6CAA6C,CAAC,CAAC;YACzG,IAAI,UAAU,KAAK,SAAS;AAAE,gBAAA,MAAM,IAAI,KAAK,CAAC,kDAAkD,CAAC,CAAC;AAClG,YAAA,IAAI,UAAU,KAAK,GAAG,IAAI,UAAU,KAAK,GAAG;AAAE,gBAAA,MAAM,IAAI,KAAK,CAAC,iCAAiC,CAAC,CAAC;AACjG,YAAA,IAAI,sBAAsB;AAAE,gBAAA,MAAM,IAAI,KAAK,CAAC,gDAAgD,CAAC,CAAC;YAC9F,MAAM,WAAW,GAAG,CAAC,GAAG,sBAAsB,CAAC,OAAO,EAAE,CAAC,CAAC,IAAI,CAAC,CAAC,GAAE,GAAG,CAAC,KAAK,GAAG,KAAK,SAAS,CAAE,CAAC,CAAC,CAAC,CAAC;AAClG,YAAA,MAAM,OAAO,GAAG,QAAQ,KAAK,CAAC,GAAG,OAAO,CAAC,OAAO,GAAG,OAAO,CAAC,OAAO,CAAC;AACnE,YAAA,MAAM,UAAU,GAAG,UAAU,KAAK,GAAG,CAAC;YACtC,OAAO;gBACH,IAAI,EAAE,IAAI,CAAC,OAAO;gBAClB,YAAY;gBACZ,YAAY;gBACZ,WAAW;gBACX,OAAO;gBACP,UAAU;gBACV,WAAW;aACd,CAAC;AACL,SAAA;AACD,QAAA;AACI,YAAA,MAAM,IAAI,KAAK,CAAC,yBAAyB,QAAQ,CAAA,CAAE,CAAC,CAAC;AAC5D,KAAA;AACL;;IC/GY,UAUX;AAVD,CAAA,UAAY,SAAS,EAAA;AACjB,IAAA,SAAA,CAAA,aAAA,CAAA,GAAA,aAA2B,CAAA;AAC3B,IAAA,SAAA,CAAA,6BAAA,CAAA,GAAA,6BAA2D,CAAA;AAC3D,IAAA,SAAA,CAAA,2BAAA,CAAA,GAAA,2BAAuD,CAAA;AACvD,IAAA,SAAA,CAAA,oBAAA,CAAA,GAAA,oBAAyC,CAAA;AACzC,IAAA,SAAA,CAAA,qBAAA,CAAA,GAAA,qBAA2C,CAAA;AAC3C,IAAA,SAAA,CAAA,cAAA,CAAA,GAAA,cAA6B,CAAA;AAC7B,IAAA,SAAA,CAAA,cAAA,CAAA,GAAA,cAA6B,CAAA;AAC7B,IAAA,SAAA,CAAA,WAAA,CAAA,GAAA,WAAuB,CAAA;AACvB,IAAA,SAAA,CAAA,0BAAA,CAAA,GAAA,wBAAmD,CAAA;AACvD,CAAC,EAVW,SAAS,KAAT,SAAS,GAUpB,EAAA,CAAA,CAAA,CAAA;AAEoB,MAAA,UAA4C,SAAQ,KAAK,CAAA;AAC1D,IAAA,IAAI,GAAmB,OAAyB,CAAC;AACjD,IAAA,SAAS,CAAI;;;AAGtB,IAAA,OAAO,CAAkG;IAEhH,WACI,CAAA,SAAY,EACZ,cAA8B;;IAE9B,OAAgG,EAAA;AAEhG,QAAA,KAAK,CAAC,cAAc,CAAC,QAAQ,EAAE,CAAC,CAAC;AAEjC,QAAA,IAAI,cAAc,YAAY,KAAK,IAAI,cAAc,CAAC,KAAK,EAAE;AACzD,YAAA,IAAI,CAAC,KAAK,GAAG,cAAc,CAAC,KAAK,CAAC;AACrC,SAAA;aAAM,IAAI,KAAK,CAAC,iBAAiB,EAAE;;;AAGhC,YAAA,KAAK,CAAC,iBAAiB,CAAC,IAAI,EAAE,UAAU,CAAC,CAAC;AAC7C,SAAA;AAED,QAAA,IAAI,CAAC,IAAI,GAAG,kBAAkB,CAAC;AAC/B,QAAA,IAAI,CAAC,SAAS,GAAG,SAAS,CAAC;AAC3B,QAAA,IAAI,CAAC,OAAO,GAAG,OAAc,CAAC;KACjC;AACJ;;ICgCW,UAOX;AAPD,CAAA,UAAY,SAAS,EAAA;AACjB,IAAA,SAAA,CAAA,MAAA,CAAA,GAAA,MAAa,CAAA;AACb,IAAA,SAAA,CAAA,SAAA,CAAA,GAAA,SAAmB,CAAA;AACnB,IAAA,SAAA,CAAA,YAAA,CAAA,GAAA,YAAyB,CAAA;AACzB,IAAA,SAAA,CAAA,oBAAA,CAAA,GAAA,oBAAyC,CAAA;AACzC,IAAA,SAAA,CAAA,oBAAA,CAAA,GAAA,oBAAyC,CAAA;AACzC,IAAA,SAAA,CAAA,OAAA,CAAA,GAAA,OAAe,CAAA;AACnB,CAAC,EAPW,SAAS,KAAT,SAAS,GAOpB,EAAA,CAAA,CAAA,CAAA;AAED;AACA;AACA;IACY,UAKX;AALD,CAAA,UAAY,SAAS,EAAA;AACjB,IAAA,SAAA,CAAA,cAAA,CAAA,GAAA,cAA6B,CAAA;AAC7B,IAAA,SAAA,CAAA,oBAAA,CAAA,GAAA,oBAAyC,CAAA;AACzC,IAAA,SAAA,CAAA,mBAAA,CAAA,GAAA,mBAAuC,CAAA;AACvC,IAAA,SAAA,CAAA,WAAA,CAAA,GAAA,WAAuB,CAAA;AAC3B,CAAC,EALW,SAAS,KAAT,SAAS,GAKpB,EAAA,CAAA,CAAA,CAAA;AAUa,MAAO,SAAS,CAAA;;AAEnB,IAAA,OAAgB,uBAAuB,GAAG,IAAI,CAAC;AAC/C,IAAA,OAAgB,qBAAqB,GAAG,GAAG,CAAC;IAE5C,OAAgB,KAAK,GAAG;AAC3B;;AAEG;AACH,QAAA,MAAM,WAAW,CAAC,YAA6B,GAAA,YAAY,CAAC,SAAS,EAAA;AACjE,YAAA,OAAO,SAAS,CAAC,WAAW,CAAC,MAAM,SAAS,CAAC,cAAc,CACvD,OAAO,gDAA8C,CAAC,EACtD,YAAY,CACf,CAAC,CAAC;SACN;AAED;;AAEG;QACH,MAAM,YAAY,CACd,OAAe,EACf,gBAAyB,EACzB,YAAA,GAAwB,YAAY,CAAC,SAAoB,EAAA;YAEzD,OAAO,SAAS,CAAC,WAAW,CAAC,MAAM,SAAS,CAAC,cAAc,CACvD,OAAO,iDAA+C,CAAC,EACvD,YAAY,EAAE,OAAO,EAAE,gBAAgB,CAC1C,CAAkD,CAAC;SACvD;AAED;;;AAGG;AACH,QAAA,MAAM,UAAU,CACZ,OAAe,EACf,OAAO,GAAG,KAAK,EACf,eAAwB,EACxB,gBAAyB,EACzB,YAA6B,GAAA,YAAY,CAAC,SAAS,EAAA;YAEnD,OAAO,SAAS,CAAC,WAAW,CAAC,MAAM,SAAS,CAAC,cAAc,CACvD,OAAO,8CAA4C,CAAC,EACpD,YAAY,EAAE,OAAO,EAAE,OAAO,EAAE,eAAe,EAAE,gBAAgB,CACpE,CAAC,CAAC;SACN;AAED;;AAEG;QACH,MAAM,mBAAmB,CACrB,OAAe,EACf,gBAAyB,EACzB,YAAA,GAA6B,YAAY,CAAC,SAAS,EAAA;AAEnD,YAAA,MAAM,OAAO,GAAG,MAAM,SAAS,CAAC,KAAK,CAAC,UAAU,CAAC,OAAO,EAAE,KAAK,EAAE,SAAS,EAAE,gBAAgB,EAAE,YAAY,CAAC,CAAC;AAC5G,YAAA,OAAO,SAAS,CAAC,KAAK,CAAC,UAAU,CAAC,OAAO,EAAE,IAAI,EAAE,OAAO,EAAE,gBAAgB,EAAE,YAAY,CAAC,CAAC;SAC7F;AAED;;AAEG;QACH,MAAM,eAAe,CACjB,aAA+B,EAC/B,gBAAyB,EACzB,YAAA,GAA6B,YAAY,CAAC,SAAS,EAAA;YAEnD,OAAO,SAAS,CAAC,WAAW,CAAC,MAAM,SAAS,CAAC,cAAc,CACvD,OAAO,mDAAiD,CAAC,EACzD,YAAY,EAAE,aAAa,EAAE,gBAAgB,CAChD,CAAC,CAAC;SACN;AAED;;;;AAIG;AACH,QAAA,MAAM,eAAe,CACjB,WAA0C,EAC1C,OAAe,EACf,gBAAyB,EACzB,YAAA,GAAwB,YAAY,CAAC,SAAoB,EAAA;YAEzD,OAAO,SAAS,CAAC,WAAW,CAAC,MAAM,SAAS,CAAC,cAAc,CACvD,OAAO,mDAAiD,CAAC,EACzD,YAAY,EAAE,OAAO,EAAE,WAAW,EAAE,gBAAgB,CACvD,CAAoD,CAAC;SACzD;AAED;;;;;AAKG;AACH,QAAA,MAAM,WAAW,CACb,OAA4B,EAC5B,OAAe,EACf,KAAkF,EAClF,gBAAyB,EACzB,YAAwB,GAAA,YAAY,CAAC,SAAoB,EAAA;YAEzD,OAAO,MAAM,SAAS,CAAC,WAAW,CAAC,MAAM,SAAS,CAAC,cAAc,CAC7D,OAAO,+CAA6C,CAAC,EACrD,YAAY,EAAE,OAAO,EAAE,OAAO,EAAE,KAAK,EAAE,gBAAgB,CAC1D,CAAuC,CAAC;SAC5C;KACJ,CAAC;IAEK,OAAgB,OAAO,GAAG;AAC7B;;AAEG;QACH,MAAM,WAAW,CAAC,OAAyC,EAAA;AACvD,YAAA,OAAO,SAAS,CAAC,WAAW,CAAC,MAAM,SAAS,CAAC,cAAc,CACvD,OAAO,kDAAkD,CAAC,EAC1D,OAAO,CACV,CAAC,CAAC;SACN;AAED;;;AAGG;QACH,MAAM,sBAAsB,CACxB,OAAe,EACf,OAAO,GAAG,KAAK,EACf,eAAwB,EACxB,gBAAyB,EAAA;YAEzB,OAAO,SAAS,CAAC,WAAW,CACxB,MAAM,SAAS,CAAC,cAAc,CAC1B,OAAO,+DAA+D,CAAC,EACvE,OAAO,EAAE,OAAO,EAAE,eAAe,EAAE,gBAAgB,CACtD,CACJ,CAAC;SACL;AAED;;AAEG;AACH,QAAA,MAAM,+BAA+B,CAAC,OAAe,EAAE,gBAAyB,EAAA;AAE5E,YAAA,MAAM,EAAE,OAAO,EAAE,GAAG,MAAM,SAAS,CAAC,OAAO,CAAC,sBAAsB,CAC9D,OAAO,EACP,KAAK,EACL,SAAS,EACT,gBAAgB,CACnB,CAAC;AACF,YAAA,OAAO,SAAS,CAAC,OAAO,CAAC,sBAAsB,CAAC,OAAO,EAAE,IAAI,EAAE,OAAO,EAAE,gBAAgB,CAAC,CAAC;SAC7F;AAED;;;;AAIG;AACH,QAAA,MAAM,oBAAoB,CAAC,OAAe,EAAE,gBAAyB,EAAA;AACjE,YAAA,OAAO,SAAS,CAAC,WAAW,CAAC,MAAM,SAAS,CAAC,cAAc,CACvD,OAAO,4DAA4D,CAAC,EACpE,OAAO,EAAE,gBAAgB,CAC5B,CAAC,CAAC;SACN;AAED;;;;AAIG;AACH,QAAA,MAAM,eAAe,CAAC,WAAmC,EAAE,gBAAyB,EAAA;AAChF,YAAA,OAAO,SAAS,CAAC,WAAW,CAAC,MAAM,SAAS,CAAC,cAAc,CACvD,OAAO,qDAAqD,CAAC,EAC7D,WAAW,EAAE,gBAAgB,CAChC,CAAC,CAAC;SACN;AAED;;;;AAIG;AACH,QAAA,MAAM,WAAW,CAAC,OAA4B,EAAE,OAAe,EAAE,gBAAyB,EAAA;YAEtF,OAAO,SAAS,CAAC,WAAW,CAAC,MAAM,SAAS,CAAC,cAAc,CACvD,OAAO,iDAAiD,CAAC,EACzD,OAAO,EAAE,OAAO,EAAE,gBAAgB,CACrC,CAAC,CAAC;SACN;KACJ,CAAC;AAEK,IAAA,WAAW,YAAY,GAAA;QAC1B,OAAO,SAAS,CAAC,aAAa,CAAC;KAClC;AAEM,IAAA,WAAW,cAAc,GAAA;QAC5B,OAAO,SAAS,CAAC,eAAe,CAAC;KACpC;AAEM,IAAA,WAAW,MAAM,GAAA;AACpB,QAAA,OAAO,CAAC,CAAC,SAAS,CAAC,eAAe,CAAC;KACtC;AAEM,IAAA,WAAW,aAAa,GAAA;QAC3B,OAAO,SAAS,CAAC,cAAc,CAAC;KACnC;AAED;;;;AAIG;IACI,OAAO,WAAW,CAAC,aAA6B,EAAA;AACnD,QAAA,OAAO,WAAW,CAAC,aAAa,CAAC,CAAC;KACrC;AAUM,IAAA,OAAO,gBAAgB,CAAC,aAA4B,EAAE,eAAwB,EAAA;AACjF,QAAA,IAAI,CAAC,WAAW,CAAC,aAAa,CAAC;AAAE,YAAA,MAAM,IAAI,KAAK,CAAC,6BAA6B,CAAC,CAAC;AAChF,QAAA,IAAI,aAAa,KAAK,SAAS,CAAC,cAAc;AACvC,gBAAC,CAAC,eAAe,IAAI,eAAe,KAAK,kBAAkB,EAAE,CAAC;YAAE,OAAO;AAC9E,QAAA,SAAS,CAAC,cAAc,GAAG,aAAa,CAAC;AACzC,QAAA,IAAI,aAAa,KAAK,aAAa,CAAC,OAAO,IAAI,eAAe,EAAE;YAC5D,kBAAkB,CAAC,eAAe,CAAC,CAAC;AACvC,SAAA;;AAED,QAAA,SAAS,CAAC,UAAU,qBAAqB,KAAK,CAAC,CAAC;KACnD;AAEM,IAAA,OAAO,kBAAkB,GAAA;AAC5B,QAAA,MAAM,aAAa,GAAG,4BAA4B,EAAE,CAAC;AACrD,QAAA,IAAI,CAAC,aAAa;YAAE,OAAO;AAC3B,QAAA,SAAS,CAAC,gBAAgB,CAAC,aAAa,CAAC,CAAC;KAC7C;AAcM,IAAA,aAAa,OAAO,CACvB,IAAU,EACV,4BAA8E,EAAA;AAE9E,QAAA,MAAM,YAAY,GAAG,4BAA4B,KAAK,YAAY,CAAC,MAAM;cACnE,YAAY,CAAC,MAAM;AACrB,cAAE,YAAY,CAAC,SAAS,CAAC;AAC7B,QAAA,MAAM,cAAc,GAAG,4BAA4B,KAAK,OAAO,CAAC,OAAO;cACjE,OAAO,CAAC,OAAO;AACjB,cAAE,OAAO,CAAC,OAAO,CAAC;AACtB,QAAA,SAAS,CAAC,kBAAkB,GAAG,KAAK,CAAC;QACrC,IAAI;YACA,MAAM,EAAE,cAAc,EAAE,kBAAkB,EAAE,iBAAiB,EAAE,GAAG,SAAS,CAAC;AAC5E,YAAA,MAAM,WAAW,GAAG,IAAI,KAAK,IAAI,CAAC,KAAK;AACnC,kBAAE,OAAO;AACT,kBAAE,CAAU,OAAA,EAAA,cAAc,KAAK,OAAO,CAAC,OAAO,GAAG,OAAO,GAAG,EAAE,EAAE,CAAC;AACpE,YAAA,IAAI,iBAAiB,IAAI,iBAAiB,CAAC,IAAI,KAAK,IAAI,IAAI,cAAc,CACtE,iBAAiB,CAAC,GAAG,EACrB,WAAW;AACX,8BAAkB,IAAI,KAAK,IAAI,CAAC,OAAO;gCACnB,IAAI,CAC3B,EAAE;;AAEC,gBAAA,OAAO,IAAI,CAAC;AACf,aAAA;AACD,YAAA,IAAI,cAAc,IAAI,cAAc,CAAC,IAAI,KAAK,IAAI;AAC3C,oBAAC,EAAE,SAAS,IAAI,cAAc,CAAC,IAAI,cAAc,CAAC,OAAO,KAAK,cAAc,CAAC,EAAE;;;AAGlF,gBAAA,MAAM,SAAS,CAAC,aAAa,CAAC,cAAc,CAAC,CAAC;gBAC9C,MAAM,IAAI,OAAO,CAAO,CAAC,OAAO,EAAE,MAAM,KAAI;oBACxC,MAAM,SAAS,GAAG,MAAK;wBACnB,SAAS,CAAC,GAAG,CAAC,SAAS,CAAC,SAAS,EAAE,SAAS,CAAC,CAAC;wBAC9C,SAAS,CAAC,GAAG,CAAC,SAAS,CAAC,iBAAiB,EAAE,QAAQ,CAAC,CAAC;AACrD,wBAAA,OAAO,EAAE,CAAC;AACd,qBAAC,CAAC;oBACF,MAAM,QAAQ,GAAG,MAAK;wBAClB,SAAS,CAAC,GAAG,CAAC,SAAS,CAAC,SAAS,EAAE,SAAS,CAAC,CAAC;wBAC9C,SAAS,CAAC,GAAG,CAAC,SAAS,CAAC,iBAAiB,EAAE,QAAQ,CAAC,CAAC;wBACrD,MAAM,CAAC,IAAI,KAAK,CAAC,mBAAmB,CAAC,CAAC,CAAC;AAC3C,qBAAC,CAAC;oBACF,SAAS,CAAC,EAAE,CAAC,SAAS,CAAC,SAAS,EAAE,SAAS,CAAC,CAAC;oBAC7C,SAAS,CAAC,EAAE,CAAC,SAAS,CAAC,iBAAiB,EAAE,QAAQ,CAAC,CAAC;AACxD,iBAAC,CAAC,CAAC;AACH,gBAAA,OAAO,IAAI,CAAC;AACf,aAAA;;;AAGD,YAAA,QAAQ,IAAI;gBACR,KAAK,IAAI,CAAC,KAAK;oBACX,MAAM,SAAS,CAAC,KAAK,CAAC,WAAW,CAAC,YAAY,CAAC,CAAC;AAChD,oBAAA,OAAO,IAAI,CAAC;gBAChB,KAAK,IAAI,CAAC,OAAO;oBACb,MAAM,SAAS,CAAC,OAAO,CAAC,WAAW,CAAC,cAAc,CAAC,CAAC;AACpD,oBAAA,OAAO,IAAI,CAAC;AAChB,gBAAA;AACI,oBAAA,MAAM,IAAI,KAAK,CAAC,qBAAqB,IAAI,CAAA,CAAE,CAAC,CAAC;AACpD,aAAA;AACJ,SAAA;AAAC,QAAA,OAAO,CAAC,EAAE;YACR,IAAI,CAAC,YAAY,UAAU,EAAE;AACzB,gBAAA,SAAS,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC;AAC1B,aAAA;AACD,YAAA,OAAO,KAAK,CAAC;AAChB,SAAA;KACJ;AAED;;;;;AAKG;IACI,aAAa,UAAU,CAAC,aAAa,GAAG,IAAI,EAAE,wBAAsD,EAAA;AACvG,QAAA,MAAM,EAAE,cAAc,EAAE,GAAG,SAAS,CAAC;AACrC,QAAA,IAAI,cAAc,EAAE;YAChB,IAAI,wBAAwB,KAAK,SAAS,EAAE;AACxC,gBAAA,wBAAwB,GAAG,KAAK,CAAC,OAAO,CAAC,wBAAwB,CAAC;AAC9D,sBAAE,wBAAwB;AAC1B,sBAAE,CAAC,wBAAwB,CAAC,CAAC;gBACjC,IAAI,CAAC,wBAAwB,CAAC,QAAQ,CAAC,cAAc,CAAC,IAAI,CAAC;oBAAE,OAAO;AACvE,aAAA;AACD,YAAA,IAAI,aAAa,EAAE;gBACf,cAAc,CAAC,MAAM,EAAE,CAAC;AAC3B,aAAA;AACJ,SAAA;AAED,QAAA,MAAM,gBAAgB,GAAG,SAAS,CAAC,iBAAiB,CAAC;AACrD,QAAA,SAAS,CAAC,iBAAiB,GAAG,IAAI,CAAC;AACnC,QAAA,SAAS,CAAC,kBAAkB,GAAG,IAAI,CAAC;AAEpC,QAAA,IAAI,CAAC,gBAAgB;YAAE,OAAO;QAC9B,IAAI;AACA,YAAA,MAAM,GAAG,GAAG,MAAM,gBAAgB,CAAC;AACnC,YAAA,MAAM,GAAG,CAAC,KAAK,EAAE,CAAC;AACrB,SAAA;AAAC,QAAA,OAAO,CAAC,EAAE;;AAEX,SAAA;KACJ;AAEM,IAAA,OAAO,EAAE,CAAC,SAAoB,EAAE,QAAuB,EAAA;QAC1D,SAAS,CAAC,WAAW,CAAC,EAAE,CAAC,SAAS,EAAE,QAAQ,CAAC,CAAC;KACjD;AAEM,IAAA,OAAO,GAAG,CAAC,SAAoB,EAAE,QAAuB,EAAA;QAC3D,SAAS,CAAC,WAAW,CAAC,GAAG,CAAC,SAAS,EAAE,QAAQ,CAAC,CAAC;KAClD;AAEM,IAAA,OAAO,IAAI,CAAC,SAAoB,EAAE,QAAuB,EAAA;QAC5D,SAAS,CAAC,WAAW,CAAC,IAAI,CAAC,SAAS,EAAE,QAAQ,CAAC,CAAC;KACnD;;AAGO,IAAA,OAAO,cAAc,GAAyB,4BAA4B,EAAE,CAAC;AAC7E,IAAA,OAAO,iBAAiB,GAA8B,IAAI,CAAC;IAC3D,OAAO,aAAa,GAAU,EAAE,IAAI,EAAE,SAAS,CAAC,IAAI,EAAE,CAAC;AACvD,IAAA,OAAO,eAAe,GAAmB,IAAI,CAAC;AAC9C,IAAA,OAAO,kBAAkB,GAA6B,IAAI,CAAC;AAC3D,IAAA,OAAO,kBAAkB,GAAY,KAAK,CAAC;AAC3C,IAAA,OAAgB,WAAW,GAAG,IAAI,UAAU,EAAE,CAAC;IAE/C,aAAa,cAAc,CAC/B,kBACsF,EACtF,GAAG,MAAiC,EAAA;QAEpC,IAAI,SAAS,CAAC,aAAa,EAAE;;AAEzB,YAAA,oBAAoB,CAAC,SAAS,CAAC,aAAa,CAAC,CAAC,KAAK,CAAC,MAAO,GAAC,CAAC,CAAC;AACjE,SAAA;QAED,IAAI,kBAAkB,YAAY,OAAO,EAAE;YACvC,IAAI;AACA,gBAAA,kBAAkB,GAAG,CAAC,MAAM,kBAAkB,EAAE,OAAO,CAAC;AAC3D,aAAA;AAAC,YAAA,OAAO,CAAC,EAAE;gBACR,MAAM,KAAK,GAAG,IAAI,UAAU,CACxB,SAAS,CAAC,2BAA2B,EACrC,CAAgC,6BAAA,EAAA,CAAC,YAAY,KAAK,GAAG,CAAC,CAAC,OAAO,GAAG,CAAC,CAAE,CAAA,EACpE,SAAS,CACZ,CAAC;AACF,gBAAA,SAAS,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC;AAC3B,gBAAA,MAAM,KAAK,CAAC;AACf,aAAA;AACJ,SAAA;QAED,IAAI;;;YAGA,OAAO,IAAI,kBAAkB,CAAC,GAAG,MAAM,CAAC,CAAC;AAC5C,SAAA;AAAC,QAAA,OAAO,CAAC,EAAE;YACR,IAAI,CAAC,YAAY,UAAU,EAAE;AACzB,gBAAA,SAAS,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC;AAC1B,aAAA;AACD,YAAA,MAAM,CAAC,CAAC;AACX,SAAA;KACJ;AAEO,IAAA,aAAa,WAAW,CAAoB,OAAU,EAAA;QAC1D,IAAI,SAAS,CAAC,MAAM,EAAE;AAClB,YAAA,MAAM,KAAK,GAAG,IAAI,UAAU,CAAC,SAAS,CAAC,WAAW,EAAE,2CAA2C,EAAE,OAAO,CAAC,CAAC;AAC1G,YAAA,SAAS,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC;AAC3B,YAAA,MAAM,KAAK,CAAC;AACf,SAAA;AACD,QAAA,SAAS,CAAC,kBAAkB,GAAG,KAAK,CAAC;QACrC,IAAI;AACA,YAAA,SAAS,CAAC,eAAe,GAAG,OAAO,CAAC;;YAEpC,OAAO,MAAM,IAAI,OAAO,CAAwB,OAAO,OAAO,EAAE,MAAM,KAAI;AACtE,gBAAA,IAAI,mBAAmB,GAAG,CAAC,CAAC,CAAC;gBAC7B,IAAI,iBAAiB,GAAG,IAAI,CAAC;gBAC7B,IAAI,WAAW,GAAG,KAAK,CAAC;AACxB,gBAAA,OAAO,CAAC,EAAE,CAAC,oBAAoB,EAAE,MAAK;;;AAGlC,oBAAA,IAAI,iBAAiB,EAAE;;;;wBAInB,IAAI,CAAC,WAAW,EAAE;4BACd,SAAS,CAAC,KAAK,CAAC,SAAS,CAAC,iBAAiB,EAAE,OAAO,CAAC,CAAC;4BACtD,WAAW,GAAG,IAAI,CAAC;AACtB,yBAAA;AACD,wBAAA,MAAM,CAAC,IAAI,KAAK,CAAC,mBAAmB,CAAC,CAAC,CAAC;AAC1C,qBAAA;AAAM,yBAAA;AACH,wBAAA,SAAS,CAAC,SAAS,CAAC,SAAS,CAAC,kBAAkB,CAAC,CAAC;AACrD,qBAAA;AACL,iBAAC,CAAC,CAAC;AACH,gBAAA,OAAO,CAAC,OAAO,CAAC,SAAS,EAAE;oBACvB,IAAI;wBACA,MAAM,SAAS,GAAG,MAAM,SAAS,CAAC,aAAa,CAAC,OAAO,CAAC,CAAC;wBACzD,IAAI,OAAO,CAAC,SAAS;4BAAE,MAAM;wBAC7B,MAAM,SAAS,CAAC,QAAQ,CAAC,SAAS,EAAE,OAAO,CAAC,CAAC;wBAC7C,IAAI,OAAO,CAAC,SAAS;4BAAE,MAAM;AAC7B,wBAAA,SAAS,CAAC,SAAS,CAAC,SAAS,CAAC,kBAAkB,CAAC,CAAC;AAClD,wBAAA,mBAAmB,GAAG,IAAI,CAAC,GAAG,EAAE,CAAC;AACjC,wBAAA,iBAAiB,GAAG,KAAK,CAAC;wBAC1B,MAAM,MAAM,GAAG,MAAM,OAAO,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;wBAC7C,IAAI,OAAO,CAAC,SAAS;4BAAE,MAAM;wBAC7B,SAAS,CAAC,KAAK,CAAC,SAAS,CAAC,kBAAkB,EAAE,OAAO,EAAE,MAAM,CAAC,CAAC;wBAC/D,OAAO,CAAC,MAAa,CAAC,CAAC;wBACvB,OAAO;AACV,qBAAA;AAAC,oBAAA,OAAO,CAAC,EAAE;AACR,wBAAA,OAAO,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;wBACjB,IAAI,CAAC,YAAY,UAAU,EAAE;AACzB,4BAAA,SAAS,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC;AAC1B,yBAAA;wBAED,MAAM,OAAO,GAAG,CAAC,CAAC,YAAY,KAAK,GAAG,CAAC,CAAC,OAAO,GAAG,MAAM,CAAC,CAAC,CAAC,EAAE,WAAW,EAAE,CAAC;;;;wBAI3E,MAAM,SAAS,GAAG,4EAA4E;6BACzF,IAAI,CAAC,OAAO,CAAC,CAAC;wBACnB,MAAM,QAAQ,GAAG,gBAAgB,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;wBAChD,MAAM,sBAAsB,GAAG,mBAAmB,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;AACjE,wBAAA,iBAAiB,GAAG,iBAAiB,IAAI,SAAS,IAAI,sBAAsB,CAAC;AAC7E,wBAAA,IAAI,SAAS,CAAC,cAAc,KAAK,aAAa,CAAC,GAAG;AAC3C,+BAAA,SAAS,CAAC,cAAc,KAAK,aAAa,CAAC,SAAS;AACpD,+BAAA,QAAQ,EAAE;;;;AAIb,4BAAA,SAAS,CAAC,kBAAkB,GAAG,IAAI,CAAC;AACvC,yBAAA;;wBAED,IAAI,OAAO,CAAC,OAAO,CAAC,oBAAoB,CAAC,KAAK,CAAC,CAAC;+BACzC,OAAO,CAAC,OAAO,CAAC,sBAAsB,CAAC,KAAK,CAAC,CAAC;AAC9C,gCAAC,SAAS,CAAC,4BAA4B,CAAC,OAAO,EAAE,mBAAmB,CAAC;AACjE,mCAAA,CAAC,SAAS,CAAC,kBAAkB,CAAC,EACvC;;;;;;4BAME,iBAAiB,GAAG,IAAI,CAAC;AACzB,4BAAA,OAAO,CAAC,MAAM,EAAE,CAAC;AACjB,4BAAA,MAAM;AACT,yBAAA;;AAED,wBAAA,IAAI,CAAC,SAAS,CAAC,YAAY,YAAY,UAAU;+BAC1C,SAAS,CAAC,YAAY,CAAC,SAAS,KAAK,SAAS,CAAC,wBAAwB;+BACvE,OAAO,CAAC,OAAO,CAAC,eAAe,CAAC,KAAK,CAAC,CAAC,EAAE;4BAC5C,MAAM,CAAC,CAAC,CAAC,CAAC;4BACV,OAAO;AACV,yBAAA;;AAED,wBAAA,IAAI,CAAC,oFAAoF;6BACpF,IAAI,CAAC,OAAO,CAAC;AACX,+BAAA,CAAC,SAAS,IAAI,CAAC,QAAQ,IAAI,CAAC,sBAAsB,EAAE;AACvD,4BAAA,OAAO,CAAC,IAAI,CAAC,sBAAsB,EAAE,CAAC,CAAC,CAAC;AAC3C,yBAAA;;wBAED,MAAM,QAAQ,GAAG,SAAS,GAAG,SAAS,CAAC,uBAAuB;;;;AAI1D,8BAAE,OAAO,CAAC,OAAO,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,GAAG,CAAC,GAAG,SAAS,CAAC,uBAAuB;;AAEpE,kCAAE,SAAS,CAAC,qBAAqB,CAAC;AAC1C,wBAAA,MAAM,IAAI,OAAO,CAAC,CAAC,QAAQ,KAAK,UAAU,CAAC,QAAQ,EAAE,QAAQ,CAAC,CAAC,CAAC;AACnE,qBAAA;AACJ,iBAAA;gBACD,IAAI,CAAC,WAAW,EAAE;oBACd,SAAS,CAAC,KAAK,CAAC,SAAS,CAAC,iBAAiB,EAAE,OAAO,CAAC,CAAC;oBACtD,WAAW,GAAG,IAAI,CAAC;AACtB,iBAAA;AACD,gBAAA,MAAM,CAAC,IAAI,KAAK,CAAC,mBAAmB,CAAC,CAAC,CAAC;AAC3C,aAAC,CAAC,CAAC;;AAEN,SAAA;AAAS,gBAAA;AACN,YAAA,SAAS,CAAC,eAAe,GAAG,IAAI,CAAC;AACjC,YAAA,IAAI,SAAS,CAAC,cAAc,KAAK,aAAa,CAAC,GAAG;AAC3C,mBAAA,SAAS,CAAC,cAAc,KAAK,aAAa,CAAC,SAAS,EAAE;AACzD,gBAAA,SAAS,CAAC,kBAAkB,GAAG,IAAI,CAAC;AACvC,aAAA;AACD,YAAA,MAAM,SAAS,GAAG,SAAS,CAAC,aAAa,YAAY,UAAU;AAC3D,kBAAE,SAAS,CAAC,aAAa,CAAC,SAAS;kBACjC,IAAI,CAAC;AACX,YAAA,IAAI,SAAS,KAAK,SAAS,CAAC,mBAAmB;AACxC,mBAAA,SAAS,KAAK,SAAS,CAAC,wBAAwB,EAAE;AACrD,gBAAA,SAAS,CAAC,SAAS,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC;AACvC,aAAA;AACJ,SAAA;KACJ;AAEO,IAAA,aAAa,QAAQ,CAAC,SAAoB,EAAE,OAAgB,EAAA;;;;;;;;AAShE,QAAA,IAAI,CAAC,SAAS,CAAC,kBAAkB,IAAI,CAAC,OAAO,CAAC,yBAAyB,CAAC,SAAS,CAAC,kBAAkB,CAAC,EAAE;AACnG,YAAA,MAAM,YAAY,GAAG,IAAI,CAAC,GAAG,EAAE,CAAC;AAChC,YAAA,SAAS,CAAC,SAAS,CAAC,SAAS,CAAC,UAAU,CAAC,CAAC;AAC1C,YAAA,SAAS,CAAC,kBAAkB,GAAG,IAAI,CAAC;YAEpC,IAAI;gBACA,SAAS,CAAC,kBAAkB,GAAG,MAAM,OAAO,CAAC,sBAAsB,CAAC,SAAS,CAAC,CAAC;AAClF,aAAA;AAAC,YAAA,OAAO,CAAC,EAAE;gBACR,MAAM,OAAO,GAAG,CAAC,CAAC,YAAY,KAAK,GAAG,CAAC,CAAC,OAAO,GAAG,MAAM,CAAC,CAAC,CAAC,EAAE,WAAW,EAAE,CAAC;gBAC3E,IAAI,OAAO,CAAC,OAAO,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,EAAE;AAChC,oBAAA,MAAM,IAAI,UAAU,CAChB,SAAS,CAAC,WAAW;;AAErB,oBAAA,CAAA,2CAAA,EAA8C,CAAC,CAAA,CAAE,EACjD,OAAO,CACV,CAAC;AACL,iBAAA;qBAAM,IAAI,SAAS,CAAC,4BAA4B,CAAC,OAAO,EAAE,YAAY,CAAC,EAAE;AACtE,oBAAA,SAAS,CAAC,kBAAkB,GAAG,IAAI,CAAC;AACpC,oBAAA,MAAM,IAAI,UAAU,CAChB,SAAS,CAAC,kBAAkB,EAC5B,CAAA,oBAAA,EAAuB,OAAO,CAAA,CAAE,EAChC,OAAO,CACV,CAAC;AACL,iBAAA;;AAGD,gBAAA,MAAM,CAAC,CAAC;AACX,aAAA;AACJ,SAAA;QAED,SAAS,CAAC,KAAK,CAAC,SAAS,CAAC,SAAS,EAAE,SAAS,CAAC,kBAAkB,CAAC,CAAC;AACnE,QAAA,OAAO,SAAS,CAAC;KACpB;AAEO,IAAA,aAAa,aAAa,CAAC,OAAgB,EAAA;QAC/C,IAAI,SAAS,CAAC,kBAAkB,EAAE;;;AAG9B,YAAA,MAAM,IAAI,KAAK,CAAC,oBAAoB,CAAC,CAAC;AACzC,SAAA;;;AAID,QAAA,MAAM,aAAa,GAAG,SAAS,CAAC,cAAc,CAAC;QAC/C,SAAS,CAAC,iBAAiB,GAAG,SAAS,CAAC,iBAAiB,IAAI,CAAC,YAAW;;YAErE,IAAI,CAAC,aAAa,IAAI,CAAC,WAAW,CAAC,aAAa,CAAC,EAAE;gBAC/C,MAAM,IAAI,UAAU,CAChB,SAAS,CAAC,mBAAmB,EAC7B,kCAAkC,EAClC,OAAO,CACV,CAAC;AACL,aAAA;;AAGD,YAAA,IAAI,YAA+D,CAAC;;AAEpE,YAAA,MAAM,0BAA0B,GAAG,UAAU,CAAC,MAAM,SAAS,CAAC,SAAS,CAAC,SAAS,CAAC,OAAO,CAAC,EAAE,EAAE,CAAC,CAAC;YAChG,IAAI;AACA,gBAAA,YAAY,GAAG,MAAM,oBAAoB,CAAC,aAAc,CAAC,CAAC;AAC7D,aAAA;AAAC,YAAA,OAAO,CAAC,EAAE;AACR,gBAAA,IAAI,aAAa,KAAK,SAAS,CAAC,cAAc,EAAE;oBAC5C,MAAM,IAAI,UAAU,CAChB,SAAS,CAAC,2BAA2B,EACrC,CAAA,6BAAA,EAAgC,CAAC,YAAY,KAAK,GAAG,CAAC,CAAC,OAAO,GAAG,CAAC,CAAE,CAAA,EACpE,OAAO,CACV,CAAC;AACL,iBAAA;AACJ,aAAA;AAAS,oBAAA;gBACN,YAAY,CAAC,0BAA0B,CAAC,CAAC;AAC5C,aAAA;AACD,YAAA,IAAI,aAAa,KAAK,SAAS,CAAC,cAAc;AAAE,gBAAA,MAAM,IAAI,KAAK,CAAC,mBAAmB,CAAC,CAAC;AAErF,YAAA,IAAI,SAAoB,CAAC;;AAEzB,YAAA,MAAM,6BAA6B,GAAG,UAAU,CAAC,MAAM,SAAS,CAAC,SAAS,CAAC,SAAS,CAAC,UAAU,CAAC,EAAE,EAAE,CAAC,CAAC;YACtG,IAAI;gBACA,SAAS,GAAG,MAAM,YAAa,CAAC,MAAM,CAClC,SAAS;;;;AAIT,gBAAA,aAAa,KAAK,aAAa,CAAC,OAAO,GAAG,IAAI,GAAG,SAAS,CAC7D,CAAC;AACL,aAAA;AAAC,YAAA,OAAO,CAAC,EAAE;AACR,gBAAA,IAAI,aAAa,KAAK,SAAS,CAAC,cAAc,EAAE;oBAC5C,MAAM,OAAO,GAAG,CAAC,CAAC,YAAY,KAAK,GAAG,CAAC,CAAC,OAAO,GAAG,MAAM,CAAC,CAAC,CAAC,EAAE,WAAW,EAAE,CAAC;AAC3E,oBAAA,IAAI,+DAA+D,CAAC,IAAI,CAAC,OAAO,CAAC,EAAE;AAC/E,wBAAA,SAAS,CAAC,kBAAkB,GAAG,IAAI,CAAC;AACpC,wBAAA,MAAM,IAAI,UAAU,CAChB,SAAS,CAAC,kBAAkB,EAC5B,CAAA,oBAAA,EAAuB,OAAO,CAAA,CAAE,EAChC,OAAO,CACV,CAAC;AACL,qBAAA;yBAAM,IAAI,OAAO,CAAC,OAAO,CAAC,cAAc,CAAC,KAAK,CAAC,CAAC,EAAE;wBAC/C,MAAM,IAAI,UAAU,CAChB,SAAS,CAAC,yBAAyB,EACnC,CAAC,YAAY,KAAK,GAAG,CAAC,GAAG,MAAM,CAAC,CAAC,CAAC,EAClC,OAAO,CACV,CAAC;AACL,qBAAA;AAAM,yBAAA;wBACH,MAAM,CAAC,CAAC;AACX,qBAAA;AACJ,iBAAA;AACJ,aAAA;AAAS,oBAAA;gBACN,YAAY,CAAC,6BAA6B,CAAC,CAAC;AAC/C,aAAA;AACD,YAAA,IAAI,aAAa,KAAK,SAAS,CAAC,cAAc,EAAE;gBAC5C,SAAU,CAAC,KAAK,EAAE,CAAC;AACnB,gBAAA,MAAM,IAAI,KAAK,CAAC,mBAAmB,CAAC,CAAC;AACxC,aAAA;YAED,MAAM,YAAY,GAAG,MAAK;AACtB,gBAAA,OAAO,CAAC,KAAK,CAAC,qBAAqB,CAAC,CAAC;AACrC,gBAAA,SAAS,CAAC,GAAG,CAAC,YAAY,EAAE,YAAY,CAAC,CAAC;AAC1C,gBAAA,IAAI,aAAa,KAAK,SAAS,CAAC,cAAc,EAAE;;;AAG5C,oBAAA,SAAS,CAAC,UAAU,qBAAqB,KAAK,CAAC,CAAC;AACnD,iBAAA;AACL,aAAC,CAAC;AACF,YAAA,SAAU,CAAC,EAAE,CAAC,YAAY,EAAE,YAAY,CAAC,CAAC;AAE1C,YAAA,OAAO,SAAU,CAAC;SACrB,GAAG,CAAC;QAEL,IAAI;AACA,YAAA,OAAO,MAAM,SAAS,CAAC,iBAAiB,CAAC;AAC5C,SAAA;AAAC,QAAA,OAAO,CAAC,EAAE;AACR,YAAA,SAAS,CAAC,iBAAiB,GAAG,IAAI,CAAC;AACnC,YAAA,IAAI,aAAa,KAAK,SAAS,CAAC,cAAc;AAAE,gBAAA,MAAM,CAAC,CAAC;;AAExD,YAAA,OAAO,SAAS,CAAC,aAAa,CAAC,OAAO,CAAC,CAAC;AAC3C,SAAA;KACJ;AAEO,IAAA,OAAO,4BAA4B,CAAC,YAAoB,EAAE,YAAoB,EAAA;;;;;AAKlF,QAAA,OAAO,wBAAwB,CAAC,IAAI,CAAC,YAAY,CAAC;AAC3C,gBAAC,8CAA8C,CAAC,IAAI,CAAC,YAAY,CAAC,IAAI,IAAI,CAAC,GAAG,EAAE,GAAG,YAAY,GAAG,KAAK,CAAC,CAAC;KACnH;IAEO,OAAO,SAAS,CAAC,KAAkD,EAAA;AACvE,QAAA,IAAI,OAAO,KAAK,KAAK,QAAQ,EAAE;;AAE3B,YAAA,KAAK,GAAG,EAAE,IAAI,EAAE,KAAK,EAAW,CAAC;AACpC,SAAA;QACD,KAAK,CAAC,OAAO,GAAG,CAAC,KAAK,CAAC,OAAO,IAAI,SAAS,CAAC,eAAe,GAAG,SAAS,CAAC,eAAe,GAAG,KAAK,CAAC,OAAO,CAAC;AAExG,QAAA,MAAM,YAAY,GAAG,SAAS,CAAC,aAAa,CAAC;AAC7C,QAAA,MAAM,gBAAgB,GAAG,YAAY,YAAY,UAAU,GAAG,YAAY,CAAC,SAAS,GAAG,IAAI,CAAC;AAC5F,QAAA,MAAM,SAAS,GAAG,KAAK,YAAY,UAAU,GAAG,KAAK,CAAC,SAAS,GAAG,IAAI,CAAC;AACvE,QAAA,IAAI,YAAY,CAAC,IAAI,KAAK,KAAK,CAAC,IAAI;AAC7B,eAAA,gBAAgB,KAAK,SAAS;AAC9B,eAAA,SAAS,CAAC,aAAa,CAAC,OAAO,KAAK,KAAK,CAAC,OAAO;YAAE,OAAO;AACjE,QAAA,SAAS,CAAC,aAAa,GAAG,KAAK,CAAC;QAChC,SAAS,CAAC,KAAK,CAAC,SAAS,CAAC,YAAY,EAAE,KAAK,CAAC,CAAC;KAClD;AAEO,IAAA,OAAO,KAAK,CAAC,SAAoB,EAAE,GAAG,IAAW,EAAA;QACrD,SAAS,CAAC,WAAW,CAAC,IAAI,CAAC,SAAS,EAAE,GAAG,IAAI,CAAC,CAAC;KAClD;;;;;"}